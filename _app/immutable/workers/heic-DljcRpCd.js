var _n=Object.defineProperty;var kn=(pr,fr,er)=>fr in pr?_n(pr,fr,{enumerable:!0,configurable:!0,writable:!0,value:er}):pr[fr]=er;var He=(pr,fr,er)=>kn(pr,typeof fr!="symbol"?fr+"":fr,er);(function(){"use strict";var pr=async function(Y={}){var G,f=Y,D,cr,hr=new Promise((r,e)=>{D=r,cr=e}),Or=typeof window=="object",Wr=typeof WorkerGlobalScope<"u";typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"&&process.type!="renderer";var mr="./this.program",Ar=(r,e)=>{throw e},ee=self.location.href,Pr="";function Hr(r){return f.locateFile?f.locateFile(r,Pr):Pr+r}var Nr,xr;if(Or||Wr){try{Pr=new URL(".",ee).href}catch{}Wr&&(xr=r=>{var e=new XMLHttpRequest;return e.open("GET",r,!1),e.responseType="arraybuffer",e.send(null),new Uint8Array(e.response)}),Nr=async r=>{var e=await fetch(r,{credentials:"same-origin"});if(e.ok)return e.arrayBuffer();throw new Error(e.status+" : "+e.url)}}var Vr=console.log.bind(console),Z=console.error.bind(console),gr,J,rr=!1,yr,tr,q,lr,wr,nr,F,br,jr,Br,Tr;function Sr(){var r=J.buffer;tr=new Int8Array(r),lr=new Int16Array(r),q=new Uint8Array(r),wr=new Uint16Array(r),nr=new Int32Array(r),F=new Uint32Array(r),br=new Float32Array(r),Tr=new Float64Array(r),jr=new BigInt64Array(r),Br=new BigUint64Array(r)}function te(){if(f.preRun)for(typeof f.preRun=="function"&&(f.preRun=[f.preRun]);f.preRun.length;)le(f.preRun.shift());Kr(Yr)}function Rr(){ar.Z()}function Cr(){if(f.postRun)for(typeof f.postRun=="function"&&(f.postRun=[f.postRun]);f.postRun.length;)ce(f.postRun.shift());Kr(Xr)}var or=0,vr=null;function qr(r){var e;or++,(e=f.monitorRunDependencies)==null||e.call(f,or)}function zr(r){var t;if(or--,(t=f.monitorRunDependencies)==null||t.call(f,or),or==0&&vr){var e=vr;vr=null,e()}}function Qr(r){var t;(t=f.onAbort)==null||t.call(f,r),r="Aborted("+r+")",Z(r),rr=!0,r+=". Build with -sASSERTIONS for more info.";var e=new WebAssembly.RuntimeError(r);throw cr(e),e}var Fr;function ne(){return f.locateFile?Hr("elheif-wasm.wasm"):new URL(""+new URL("assets/elheif-wasm-Cde5jrns.wasm",self.location.href).href,self.location.href).href}function oe(r){if(r==Fr&&gr)return new Uint8Array(gr);if(xr)return xr(r);throw"both async and sync fetching of the wasm failed"}async function ie(r){if(!gr)try{var e=await Nr(r);return new Uint8Array(e)}catch{}return oe(r)}async function ae(r,e){try{var t=await ie(r),n=await WebAssembly.instantiate(t,e);return n}catch(o){Z(`failed to asynchronously prepare wasm: ${o}`),Qr(o)}}async function se(r,e,t){if(!r&&typeof WebAssembly.instantiateStreaming=="function")try{var n=fetch(e,{credentials:"same-origin"}),o=await WebAssembly.instantiateStreaming(n,t);return o}catch(i){Z(`wasm streaming compile failed: ${i}`),Z("falling back to ArrayBuffer instantiation")}return ae(e,t)}function ue(){return{a:pn}}async function fe(){function r(i,c){return ar=i.exports,J=ar.Y,Sr(),xe=ar.$,zr(),ar}qr();function e(i){return r(i.instance)}var t=ue();if(f.instantiateWasm)return new Promise((i,c)=>{f.instantiateWasm(t,(a,m)=>{i(r(a))})});Fr??(Fr=ne());try{var n=await se(gr,Fr,t),o=e(n);return o}catch(i){return cr(i),Promise.reject(i)}}class Gr{constructor(e){He(this,"name","ExitStatus");this.message=`Program terminated with exit(${e})`,this.status=e}}var Kr=r=>{for(;r.length>0;)r.shift()(f)},Xr=[],ce=r=>Xr.push(r),Yr=[],le=r=>Yr.push(r),$r=!0;class l{constructor(e){this.excPtr=e,this.ptr=e-24}set_type(e){F[this.ptr+4>>2]=e}get_type(){return F[this.ptr+4>>2]}set_destructor(e){F[this.ptr+8>>2]=e}get_destructor(){return F[this.ptr+8>>2]}set_caught(e){e=e?1:0,tr[this.ptr+12]=e}get_caught(){return tr[this.ptr+12]!=0}set_rethrown(e){e=e?1:0,tr[this.ptr+13]=e}get_rethrown(){return tr[this.ptr+13]!=0}init(e,t){this.set_adjusted_ptr(0),this.set_type(e),this.set_destructor(t)}set_adjusted_ptr(e){F[this.ptr+16>>2]=e}get_adjusted_ptr(){return F[this.ptr+16>>2]}}var h=0,p=(r,e,t)=>{var n=new l(r);throw n.init(e,t),h=r,h},A=typeof TextDecoder<"u"?new TextDecoder:void 0,k=(r,e=0,t=NaN)=>{for(var n=e+t,o=e;r[o]&&!(o>=n);)++o;if(o-e>16&&r.buffer&&A)return A.decode(r.subarray(e,o));for(var i="";e<o;){var c=r[e++];if(!(c&128)){i+=String.fromCharCode(c);continue}var a=r[e++]&63;if((c&224)==192){i+=String.fromCharCode((c&31)<<6|a);continue}var m=r[e++]&63;if((c&240)==224?c=(c&15)<<12|a<<6|m:c=(c&7)<<18|a<<12|m<<6|r[e++]&63,c<65536)i+=String.fromCharCode(c);else{var _=c-65536;i+=String.fromCharCode(55296|_>>10,56320|_&1023)}}return i},C=(r,e)=>r?k(q,r,e):"";function s(r,e,t){return 0}var L=(r,e,t)=>{};function R(r,e,t){return 0}function I(r,e,t,n){}var V=(r,e,t)=>{},g=()=>Qr(""),v={},u=r=>{for(;r.length;){var e=r.pop(),t=r.pop();t(e)}};function y(r){return this.fromWireType(F[r>>2])}var b={},P={},H={},z=f.InternalError=class extends Error{constructor(e){super(e),this.name="InternalError"}},K=r=>{throw new z(r)},X=(r,e,t)=>{r.forEach(a=>H[a]=e);function n(a){var m=t(a);m.length!==r.length&&K("Mismatched type converter count");for(var _=0;_<r.length;++_)O(r[_],m[_])}var o=new Array(e.length),i=[],c=0;e.forEach((a,m)=>{P.hasOwnProperty(a)?o[m]=P[a]:(i.push(a),b.hasOwnProperty(a)||(b[a]=[]),b[a].push(()=>{o[m]=P[a],++c,c===i.length&&n(o)}))}),i.length===0&&n(o)},ir=r=>{var e=v[r];delete v[r];var t=e.rawConstructor,n=e.rawDestructor,o=e.fields,i=o.map(c=>c.getterReturnType).concat(o.map(c=>c.setterArgumentType));X([r],i,c=>{var a={};return o.forEach((m,_)=>{var T=m.fieldName,S=c[_],Q=c[_].optional,sr=m.getter,ur=m.getterContext,re=c[_+o.length],ye=m.setter,we=m.setterContext;a[T]={read:_e=>S.fromWireType(sr(ur,_e)),write:(_e,wn)=>{var Ie=[];ye(we,_e,re.toWireType(Ie,wn)),u(Ie)},optional:Q}}),[{name:e.name,fromWireType:m=>{var _={};for(var T in a)_[T]=a[T].read(m);return n(m),_},toWireType:(m,_)=>{for(var T in a)if(!(T in _)&&!a[T].optional)throw new TypeError(`Missing field: "${T}"`);var S=t();for(T in a)a[T].write(S,_[T]);return m!==null&&m.push(n,S),S},argPackAdvance:M,readValueFromPointer:y,destructorFunction:n}]})},E=r=>{if(r===null)return"null";var e=typeof r;return e==="object"||e==="array"||e==="function"?r.toString():""+r},x=()=>{for(var r=new Array(256),e=0;e<256;++e)r[e]=String.fromCharCode(e);d=r},d,w=r=>{for(var e="",t=r;q[t];)e+=d[q[t++]];return e},j=f.BindingError=class extends Error{constructor(e){super(e),this.name="BindingError"}},W=r=>{throw new j(r)};function $(r,e,t={}){var n=e.name;if(r||W(`type "${n}" must have a positive integer typeid pointer`),P.hasOwnProperty(r)){if(t.ignoreDuplicateRegistrations)return;W(`Cannot register type '${n}' twice`)}if(P[r]=e,delete H[r],b.hasOwnProperty(r)){var o=b[r];delete b[r],o.forEach(i=>i())}}function O(r,e,t={}){return $(r,e,t)}var B=(r,e,t)=>{switch(e){case 1:return t?n=>tr[n]:n=>q[n];case 2:return t?n=>lr[n>>1]:n=>wr[n>>1];case 4:return t?n=>nr[n>>2]:n=>F[n>>2];case 8:return t?n=>jr[n>>3]:n=>Br[n>>3];default:throw new TypeError(`invalid integer width (${e}): ${r}`)}},U=(r,e,t,n,o)=>{e=w(e);var i=e.indexOf("u")!=-1;O(r,{name:e,fromWireType:c=>c,toWireType:function(c,a){if(typeof a!="bigint"&&typeof a!="number")throw new TypeError(`Cannot convert "${E(a)}" to ${this.name}`);return typeof a=="number"&&(a=BigInt(a)),a},argPackAdvance:M,readValueFromPointer:B(e,t,!i),destructorFunction:null})},M=8,Xe=(r,e,t,n)=>{e=w(e),O(r,{name:e,fromWireType:function(o){return!!o},toWireType:function(o,i){return i?t:n},argPackAdvance:M,readValueFromPointer:function(o){return this.fromWireType(q[o])},destructorFunction:null})},de=[],dr=[],ve=r=>{r>9&&--dr[r+1]===0&&(dr[r]=void 0,de.push(r))},Ye=()=>dr.length/2-5-de.length,Je=()=>{dr.push(0,1,void 0,1,null,1,!0,1,!1,1),f.count_emval_handles=Ye},N={toValue:r=>(r||W(`Cannot use deleted val. handle = ${r}`),dr[r]),toHandle:r=>{switch(r){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:{const e=de.pop()||dr.length;return dr[e]=r,dr[e+1]=1,e}}}},Te={name:"emscripten::val",fromWireType:r=>{var e=N.toValue(r);return ve(r),e},toWireType:(r,e)=>N.toHandle(e),argPackAdvance:M,readValueFromPointer:y,destructorFunction:null},Ee=r=>O(r,Te),Ze=(r,e,t)=>{if(r[e].overloadTable===void 0){var n=r[e];r[e]=function(...o){return r[e].overloadTable.hasOwnProperty(o.length)||W(`Function '${t}' called with an invalid number of arguments (${o.length}) - expects one of (${r[e].overloadTable})!`),r[e].overloadTable[o.length].apply(this,o)},r[e].overloadTable=[],r[e].overloadTable[n.argCount]=n}},Oe=(r,e,t)=>{f.hasOwnProperty(r)?((t===void 0||f[r].overloadTable!==void 0&&f[r].overloadTable[t]!==void 0)&&W(`Cannot register public name '${r}' twice`),Ze(f,r,r),f[r].overloadTable.hasOwnProperty(t)&&W(`Cannot register multiple overloads of a function with the same number of arguments (${t})!`),f[r].overloadTable[t]=e):(f[r]=e,f[r].argCount=t)},rt=(r,e,t)=>{switch(e){case 1:return t?function(n){return this.fromWireType(tr[n])}:function(n){return this.fromWireType(q[n])};case 2:return t?function(n){return this.fromWireType(lr[n>>1])}:function(n){return this.fromWireType(wr[n>>1])};case 4:return t?function(n){return this.fromWireType(nr[n>>2])}:function(n){return this.fromWireType(F[n>>2])};default:throw new TypeError(`invalid integer width (${e}): ${r}`)}},et=(r,e,t,n)=>{e=w(e);function o(){}o.values={},O(r,{name:e,constructor:o,fromWireType:function(i){return this.constructor.values[i]},toWireType:(i,c)=>c.value,argPackAdvance:M,readValueFromPointer:rt(e,t,n),destructorFunction:null}),Oe(e,o)},pe=(r,e)=>Object.defineProperty(e,"name",{value:r}),We=r=>{var e=hn(r),t=w(e);return _r(e),t},Jr=(r,e)=>{var t=P[r];return t===void 0&&W(`${e} has unknown type ${We(r)}`),t},tt=(r,e,t)=>{var n=Jr(r,"enum");e=w(e);var o=n.constructor,i=Object.create(n.constructor.prototype,{value:{value:t},constructor:{value:pe(`${n.name}_${e}`,function(){})}});o.values[t]=i,o[e]=i},nt=(r,e)=>{switch(e){case 4:return function(t){return this.fromWireType(br[t>>2])};case 8:return function(t){return this.fromWireType(Tr[t>>3])};default:throw new TypeError(`invalid float width (${e}): ${r}`)}},ot=(r,e,t)=>{e=w(e),O(r,{name:e,fromWireType:n=>n,toWireType:(n,o)=>o,argPackAdvance:M,readValueFromPointer:nt(e,t),destructorFunction:null})};function Ae(r){for(var e=1;e<r.length;++e)if(r[e]!==null&&r[e].destructorFunction===void 0)return!0;return!1}function it(r,e,t,n){for(var o=Ae(r),i=r.length-2,c=[],a=["fn"],m=0;m<i;++m)c.push(`arg${m}`),a.push(`arg${m}Wired`);c=c.join(","),a=a.join(",");var _=`return function (${c}) {
`;o&&(_+=`var destructors = [];
`);for(var T=o?"destructors":"null",S=["humanName","throwBindingError","invoker","fn","runDestructors","retType","classParam"],m=0;m<i;++m)_+=`var arg${m}Wired = argType${m}['toWireType'](${T}, arg${m});
`,S.push(`argType${m}`);if(_+=(t||n?"var rv = ":"")+`invoker(${a});
`,o)_+=`runDestructors(destructors);
`;else for(var m=2;m<r.length;++m){var Q=m===1?"thisWired":"arg"+(m-2)+"Wired";r[m].destructorFunction!==null&&(_+=`${Q}_dtor(${Q});
`,S.push(`${Q}_dtor`))}return t&&(_+=`var ret = retType['fromWireType'](rv);
return ret;
`),_+=`}
`,[S,_]}function at(r,e,t,n,o,i){var c=e.length;c<2&&W("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var a=e[1]!==null&&t!==null,m=Ae(e),_=e[0].name!=="void",T=[r,W,n,o,u,e[0],e[1]],S=0;S<c-2;++S)T.push(e[S+2]);if(!m)for(var S=2;S<e.length;++S)e[S].destructorFunction!==null&&T.push(e[S].destructorFunction);let[Q,sr]=it(e,a,_,i);var ur=new Function(...Q,sr)(...T);return pe(r,ur)}var st=(r,e)=>{for(var t=[],n=0;n<r;n++)t.push(F[e+n*4>>2]);return t},ut=(r,e,t)=>{f.hasOwnProperty(r)||K("Replacing nonexistent public symbol"),f[r].overloadTable!==void 0&&t!==void 0?f[r].overloadTable[t]=e:(f[r]=e,f[r].argCount=t)},Pe=[],xe,ft=r=>{var e=Pe[r];return e||(Pe[r]=e=xe.get(r)),e},Lr=(r,e,t=!1)=>{r=w(r);function n(){var i=ft(e);return i}var o=n();return typeof o!="function"&&W(`unknown function pointer with signature ${r}: ${e}`),o};class ct extends Error{}var lt=(r,e)=>{var t=[],n={};function o(i){if(!n[i]&&!P[i]){if(H[i]){H[i].forEach(o);return}t.push(i),n[i]=!0}}throw e.forEach(o),new ct(`${r}: `+t.map(We).join([", "]))},dt=r=>{r=r.trim();const e=r.indexOf("(");return e===-1?r:r.slice(0,e)},vt=(r,e,t,n,o,i,c,a)=>{var m=st(e,t);r=w(r),r=dt(r),o=Lr(n,o,c),Oe(r,function(){lt(`Cannot call ${r} due to unbound types`,m)},e-1),X([],m,_=>{var T=[_[0],null].concat(_.slice(1));return ut(r,at(r,T,null,o,i,c),e-1),[]})},pt=(r,e,t,n,o)=>{e=w(e);var i=T=>T;if(n===0){var c=32-8*t;i=T=>T<<c>>>c}var a=e.includes("unsigned"),m=(T,S)=>{},_;a?_=function(T,S){return m(S,this.name),S>>>0}:_=function(T,S){return m(S,this.name),S},O(r,{name:e,fromWireType:i,toWireType:_,argPackAdvance:M,readValueFromPointer:B(e,t,n!==0),destructorFunction:null})},ht=(r,e,t)=>{var n=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array],o=n[e];function i(c){var a=F[c>>2],m=F[c+4>>2];return new o(tr.buffer,m,a)}t=w(t),O(r,{name:t,fromWireType:i,argPackAdvance:M,readValueFromPointer:i},{ignoreDuplicateRegistrations:!0})},mt=Object.assign({optional:!0},Te),gt=(r,e)=>{O(r,mt)},yt=(r,e,t,n)=>{if(!(n>0))return 0;for(var o=t,i=t+n-1,c=0;c<r.length;++c){var a=r.charCodeAt(c);if(a>=55296&&a<=57343){var m=r.charCodeAt(++c);a=65536+((a&1023)<<10)|m&1023}if(a<=127){if(t>=i)break;e[t++]=a}else if(a<=2047){if(t+1>=i)break;e[t++]=192|a>>6,e[t++]=128|a&63}else if(a<=65535){if(t+2>=i)break;e[t++]=224|a>>12,e[t++]=128|a>>6&63,e[t++]=128|a&63}else{if(t+3>=i)break;e[t++]=240|a>>18,e[t++]=128|a>>12&63,e[t++]=128|a>>6&63,e[t++]=128|a&63}}return e[t]=0,t-o},Er=(r,e,t)=>yt(r,q,e,t),je=r=>{for(var e=0,t=0;t<r.length;++t){var n=r.charCodeAt(t);n<=127?e++:n<=2047?e+=2:n>=55296&&n<=57343?(e+=4,++t):e+=3}return e},wt=(r,e)=>{e=w(e),O(r,{name:e,fromWireType(t){for(var n=F[t>>2],o=t+4,i,c,a=o,c=0;c<=n;++c){var m=o+c;if(c==n||q[m]==0){var _=m-a,T=C(a,_);i===void 0?i=T:(i+="\0",i+=T),a=m+1}}return _r(t),i},toWireType(t,n){n instanceof ArrayBuffer&&(n=new Uint8Array(n));var o,i=typeof n=="string";i||ArrayBuffer.isView(n)&&n.BYTES_PER_ELEMENT==1||W("Cannot pass non-string to std::string"),i?o=je(n):o=n.length;var c=De(4+o+1),a=c+4;return F[c>>2]=o,i?Er(n,a,o+1):q.set(n,a),t!==null&&t.push(_r,c),c},argPackAdvance:M,readValueFromPointer:y,destructorFunction(t){_r(t)}})},Se=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,_t=(r,e)=>{for(var t=r,n=t>>1,o=n+e/2;!(n>=o)&&wr[n];)++n;if(t=n<<1,t-r>32&&Se)return Se.decode(q.subarray(r,t));for(var i="",c=0;!(c>=e/2);++c){var a=lr[r+c*2>>1];if(a==0)break;i+=String.fromCharCode(a)}return i},kt=(r,e,t)=>{if(t??(t=2147483647),t<2)return 0;t-=2;for(var n=e,o=t<r.length*2?t/2:r.length,i=0;i<o;++i){var c=r.charCodeAt(i);lr[e>>1]=c,e+=2}return lr[e>>1]=0,e-n},bt=r=>r.length*2,Tt=(r,e)=>{for(var t=0,n="";!(t>=e/4);){var o=nr[r+t*4>>2];if(o==0)break;if(++t,o>=65536){var i=o-65536;n+=String.fromCharCode(55296|i>>10,56320|i&1023)}else n+=String.fromCharCode(o)}return n},Et=(r,e,t)=>{if(t??(t=2147483647),t<4)return 0;for(var n=e,o=n+t-4,i=0;i<r.length;++i){var c=r.charCodeAt(i);if(c>=55296&&c<=57343){var a=r.charCodeAt(++i);c=65536+((c&1023)<<10)|a&1023}if(nr[e>>2]=c,e+=4,e+4>o)break}return nr[e>>2]=0,e-n},Ot=r=>{for(var e=0,t=0;t<r.length;++t){var n=r.charCodeAt(t);n>=55296&&n<=57343&&++t,e+=4}return e},Wt=(r,e,t)=>{t=w(t);var n,o,i,c;e===2?(n=_t,o=kt,c=bt,i=a=>wr[a>>1]):e===4&&(n=Tt,o=Et,c=Ot,i=a=>F[a>>2]),O(r,{name:t,fromWireType:a=>{for(var m=F[a>>2],_,T=a+4,S=0;S<=m;++S){var Q=a+4+S*e;if(S==m||i(Q)==0){var sr=Q-T,ur=n(T,sr);_===void 0?_=ur:(_+="\0",_+=ur),T=Q+e}}return _r(a),_},toWireType:(a,m)=>{typeof m!="string"&&W(`Cannot pass non-string to C++ string type ${t}`);var _=c(m),T=De(4+_+e);return F[T>>2]=_/e,o(m,T+4,_+e),a!==null&&a.push(_r,T),T},argPackAdvance:M,readValueFromPointer:y,destructorFunction(a){_r(a)}})},At=(r,e)=>{Ee(r)},Pt=(r,e,t,n,o,i)=>{v[r]={name:w(e),rawConstructor:Lr(t,n),rawDestructor:Lr(o,i),fields:[]}},xt=(r,e,t,n,o,i,c,a,m,_)=>{v[r].fields.push({fieldName:w(e),getterReturnType:t,getter:Lr(n,o),getterContext:i,setterArgumentType:c,setter:Lr(a,m),setterContext:_})},jt=(r,e)=>{e=w(e),O(r,{isVoid:!0,name:e,argPackAdvance:0,fromWireType:()=>{},toWireType:(t,n)=>{}})},Re=0,St=()=>{$r=!1,Re=0},Ce=(r,e,t)=>{var n=[],o=r.toWireType(n,t);return n.length&&(F[e>>2]=N.toHandle(n)),o},Rt=(r,e,t)=>(r=N.toValue(r),e=Jr(e,"emval::as"),Ce(e,t,r)),Zr=[],Ct=(r,e,t,n)=>(r=Zr[r],e=N.toValue(e),r(null,e,t,n)),Ft={},he=r=>{var e=Ft[r];return e===void 0?w(r):e},$t=(r,e,t,n,o)=>(r=Zr[r],e=N.toValue(e),t=he(t),r(e,e[t],n,o)),Fe=()=>typeof globalThis=="object"?globalThis:function(){return Function}()("return this")(),Lt=r=>r===0?N.toHandle(Fe()):(r=he(r),N.toHandle(Fe()[r])),Mt=r=>{var e=Zr.length;return Zr.push(r),e},Ut=(r,e)=>{for(var t=new Array(r),n=0;n<r;++n)t[n]=Jr(F[e+n*4>>2],`parameter ${n}`);return t},Dt=(r,e,t)=>{var n=Ut(r,e),o=n.shift();r--;var i=`return function (obj, func, destructorsRef, args) {
`,c=0,a=[];t===0&&a.push("obj");for(var m=["retType"],_=[o],T=0;T<r;++T)a.push(`arg${T}`),m.push(`argType${T}`),_.push(n[T]),i+=`  var arg${T} = argType${T}.readValueFromPointer(args${c?"+"+c:""});
`,c+=n[T].argPackAdvance;var S=t===1?"new func":"func.call";i+=`  var rv = ${S}(${a.join(", ")});
`,o.isVoid||(m.push("emval_returnValue"),_.push(Ce),i+=`  return emval_returnValue(retType, destructorsRef, rv);
`),i+=`};
`;var Q=new Function(...m,i)(..._),sr=`methodCaller<(${n.map(ur=>ur.name).join(", ")}) => ${o.name}>`;return Mt(pe(sr,Q))},It=(r,e)=>(r=N.toValue(r),e=N.toValue(e),N.toHandle(r[e])),Ht=r=>{r>9&&(dr[r+1]+=1)},Nt=()=>N.toHandle([]),Vt=r=>N.toHandle(he(r)),Bt=()=>N.toHandle({}),qt=r=>{var e=N.toValue(r);u(e),ve(r)},zt=(r,e,t)=>{r=N.toValue(r),e=N.toValue(e),t=N.toValue(t),r[e]=t},Qt=(r,e)=>{r=Jr(r,"_emval_take_value");var t=r.readValueFromPointer(e);return N.toHandle(t)},Mr={},$e=r=>{if(r instanceof Gr||r=="unwind")return yr;Ar(1,r)},Le=()=>$r||Re>0,Me=r=>{var e;yr=r,Le()||((e=f.onExit)==null||e.call(f,r),rr=!0),Ar(r,new Gr(r))},Gt=(r,e)=>{yr=r,Me(r)},Ue=Gt,Kt=()=>{if(!Le())try{Ue(yr)}catch(r){$e(r)}},Xt=r=>{if(!rr)try{r(),Kt()}catch(e){$e(e)}},Yt=()=>performance.now(),Jt=(r,e)=>{if(Mr[r]&&(clearTimeout(Mr[r].id),delete Mr[r]),!e)return 0;var t=setTimeout(()=>{delete Mr[r],Xt(()=>mn(r,Yt()))},e);return Mr[r]={id:t,timeout_ms:e},0},Zt=(r,e,t,n)=>{var o=new Date().getFullYear(),i=new Date(o,0,1),c=new Date(o,6,1),a=i.getTimezoneOffset(),m=c.getTimezoneOffset(),_=Math.max(a,m);F[r>>2]=_*60,nr[e>>2]=+(a!=m);var T=sr=>{var ur=sr>=0?"-":"+",re=Math.abs(sr),ye=String(Math.floor(re/60)).padStart(2,"0"),we=String(re%60).padStart(2,"0");return`UTC${ur}${ye}${we}`},S=T(a),Q=T(m);m<a?(Er(S,t,17),Er(Q,n,17)):(Er(S,n,17),Er(Q,t,17))},rn=()=>2147483648,en=(r,e)=>Math.ceil(r/e)*e,tn=r=>{var e=J.buffer,t=(r-e.byteLength+65535)/65536|0;try{return J.grow(t),Sr(),1}catch{}},nn=r=>{var e=q.length;r>>>=0;var t=rn();if(r>t)return!1;for(var n=1;n<=4;n*=2){var o=e*(1+.2/n);o=Math.min(o,r+100663296);var i=Math.min(t,en(Math.max(r,o),65536)),c=tn(i);if(c)return!0}return!1},me={},on=()=>mr||"./this.program",Ur=()=>{if(!Ur.strings){var r=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:r,_:on()};for(var t in me)me[t]===void 0?delete e[t]:e[t]=me[t];var n=[];for(var t in e)n.push(`${t}=${e[t]}`);Ur.strings=n}return Ur.strings},an=(r,e)=>{var t=0,n=0;for(var o of Ur()){var i=e+t;F[r+n>>2]=i,t+=Er(o,i,1/0)+1,n+=4}return 0},sn=(r,e)=>{var t=Ur();F[r>>2]=t.length;var n=0;for(var o of t)n+=je(o)+1;return F[e>>2]=n,0},un=r=>52,fn=(r,e,t,n)=>52;function cn(r,e,t,n){return 70}var ln=[null,[],[]],dn=(r,e)=>{var t=ln[r];e===0||e===10?((r===1?Vr:Z)(k(t)),t.length=0):t.push(e)},vn=(r,e,t,n)=>{for(var o=0,i=0;i<t;i++){var c=F[e>>2],a=F[e+4>>2];e+=8;for(var m=0;m<a;m++)dn(r,q[c+m]);o+=a}return F[n>>2]=o,0};x(),Je(),f.noExitRuntime&&($r=f.noExitRuntime),f.print&&(Vr=f.print),f.printErr&&(Z=f.printErr),f.wasmBinary&&(gr=f.wasmBinary),f.arguments&&f.arguments,f.thisProgram&&(mr=f.thisProgram);var pn={p,F:s,X:L,W:R,E:I,V,Q:g,B:ir,A:U,P:Xe,O:Ee,z:et,a:tt,y:ot,x:vt,g:pt,c:ht,N:gt,M:wt,u:Wt,o:At,w:Pt,l:xt,L:jt,K:St,k:Rt,r:Ct,q:$t,b:ve,n:Lt,i:Dt,h:It,f:Ht,J:Nt,e:Vt,m:Bt,d:qt,j:zt,t:Qt,I:Jt,H:Zt,G:nn,U:an,T:sn,v:Ue,s:un,D:fn,S:cn,C:vn,R:Me},ar=await fe();ar.Z;var De=ar._,hn=ar.aa,_r=ar.ba,mn=ar.ca;function ge(){if(or>0){vr=ge;return}if(te(),or>0){vr=ge;return}function r(){var e;f.calledRun=!0,!rr&&(Rr(),D(f),(e=f.onRuntimeInitialized)==null||e.call(f),Cr())}f.setStatus?(f.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>f.setStatus(""),1),r()},1)):r()}function gn(){if(f.preInit)for(typeof f.preInit=="function"&&(f.preInit=[f.preInit]);f.preInit.length>0;)f.preInit.shift()()}gn(),ge();const yn=["heif_error_code","heif_suberror_code"];for(const r of yn)for(const e in f[r])!f[r].hasOwnProperty(e)||e==="values"||(f[e]=f[r][e]);return G=hr,G};function fr(Y){if(Object.prototype.hasOwnProperty.call(Y,"__esModule"))return Y;var G=Y.default;if(typeof G=="function"){var f=function D(){return this instanceof D?Reflect.construct(G,arguments,this.constructor):G.apply(this,arguments)};f.prototype=G.prototype}else f={};return Object.defineProperty(f,"__esModule",{value:!0}),Object.keys(Y).forEach(function(D){var cr=Object.getOwnPropertyDescriptor(Y,D);Object.defineProperty(f,D,cr.get?cr:{enumerable:!0,get:function(){return Y[D]}})}),f}var er={exports:{}},Ne={},Ve=Object.freeze({__proto__:null,default:Ne}),kr=fr(Ve);/**
 * workerpool.js
 * https://github.com/josdejong/workerpool
 *
 * Offload tasks to a pool of workers on node.js and in the browser.
 *
 * @version 9.2.0
 * @date    2024-10-11
 *
 * @license
 * Copyright (C) 2014-2022 Jos de Jong <wjosdejong@gmail.com>
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not
 * use this file except in compliance with the License. You may obtain a copy
 * of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
 * License for the specific language governing permissions and limitations under
 * the License.
 */var Be=er.exports,ke;function qe(){return ke||(ke=1,function(Y,G){(function(f,D){D(G)})(Be,function(f){var D={},cr={exports:{}};(function(l){var h=function(k){return typeof k<"u"&&k.versions!=null&&k.versions.node!=null&&k+""=="[object process]"};l.exports.isNode=h,l.exports.platform=typeof process<"u"&&h(process)?"node":"browser";var p=l.exports.platform==="node"&&kr;l.exports.isMainThread=l.exports.platform==="node"?(!p||p.isMainThread)&&!process.connected:typeof Window<"u",l.exports.cpus=l.exports.platform==="browser"?self.navigator.hardwareConcurrency:kr.cpus().length})(cr);var hr=cr.exports,Or={},Wr;function mr(){if(Wr)return Or;Wr=1;function l(k,C){var s=this;if(!(this instanceof l))throw new SyntaxError("Constructor must be called with the new operator");if(typeof k!="function")throw new SyntaxError("Function parameter handler(resolve, reject) missing");var L=[],R=[];this.resolved=!1,this.rejected=!1,this.pending=!0;var I=function(u,y){L.push(u),R.push(y)};this.then=function(v,u){return new l(function(y,b){var P=v?h(v,y,b):y,H=u?h(u,y,b):b;I(P,H)},s)};var V=function(u){return s.resolved=!0,s.rejected=!1,s.pending=!1,L.forEach(function(y){y(u)}),I=function(b,P){b(u)},V=g=function(){},s},g=function(u){return s.resolved=!1,s.rejected=!0,s.pending=!1,R.forEach(function(y){y(u)}),I=function(b,P){P(u)},V=g=function(){},s};this.cancel=function(){return C?C.cancel():g(new p),s},this.timeout=function(v){if(C)C.timeout(v);else{var u=setTimeout(function(){g(new A("Promise timed out after "+v+" ms"))},v);s.always(function(){clearTimeout(u)})}return s},k(function(v){V(v)},function(v){g(v)})}function h(k,C,s){return function(L){try{var R=k(L);R&&typeof R.then=="function"&&typeof R.catch=="function"?R.then(C,s):C(R)}catch(I){s(I)}}}l.prototype.catch=function(k){return this.then(null,k)},l.prototype.always=function(k){return this.then(k,k)},l.prototype.finally=function(k){var C=this,s=function(){return new l(function(R){return R()}).then(k).then(function(){return C})};return this.then(s,s)},l.all=function(k){return new l(function(C,s){var L=k.length,R=[];L?k.forEach(function(I,V){I.then(function(g){R[V]=g,L--,L==0&&C(R)},function(g){L=0,s(g)})}):C(R)})},l.defer=function(){var k={};return k.promise=new l(function(C,s){k.resolve=C,k.reject=s}),k};function p(k){this.message=k||"promise cancelled",this.stack=new Error().stack}p.prototype=new Error,p.prototype.constructor=Error,p.prototype.name="CancellationError",l.CancellationError=p;function A(k){this.message=k||"timeout exceeded",this.stack=new Error().stack}return A.prototype=new Error,A.prototype.constructor=Error,A.prototype.name="TimeoutError",l.TimeoutError=A,Or.Promise=l,Or}function Ar(l,h){(h==null||h>l.length)&&(h=l.length);for(var p=0,A=Array(h);p<h;p++)A[p]=l[p];return A}function ee(l,h){var p=typeof Symbol<"u"&&l[Symbol.iterator]||l["@@iterator"];if(!p){if(Array.isArray(l)||(p=gr(l))||h){p&&(l=p);var A=0,k=function(){};return{s:k,n:function(){return A>=l.length?{done:!0}:{done:!1,value:l[A++]}},e:function(R){throw R},f:k}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var C,s=!0,L=!1;return{s:function(){p=p.call(l)},n:function(){var R=p.next();return s=R.done,R},e:function(R){L=!0,C=R},f:function(){try{s||p.return==null||p.return()}finally{if(L)throw C}}}}function Pr(l,h,p){return(h=Vr(h))in l?Object.defineProperty(l,h,{value:p,enumerable:!0,configurable:!0,writable:!0}):l[h]=p,l}function Hr(l,h){var p=Object.keys(l);if(Object.getOwnPropertySymbols){var A=Object.getOwnPropertySymbols(l);h&&(A=A.filter(function(k){return Object.getOwnPropertyDescriptor(l,k).enumerable})),p.push.apply(p,A)}return p}function Nr(l){for(var h=1;h<arguments.length;h++){var p=arguments[h]!=null?arguments[h]:{};h%2?Hr(Object(p),!0).forEach(function(A){Pr(l,A,p[A])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(p)):Hr(Object(p)).forEach(function(A){Object.defineProperty(l,A,Object.getOwnPropertyDescriptor(p,A))})}return l}function xr(l,h){if(typeof l!="object"||!l)return l;var p=l[Symbol.toPrimitive];if(p!==void 0){var A=p.call(l,h);if(typeof A!="object")return A;throw new TypeError("@@toPrimitive must return a primitive value.")}return(h==="string"?String:Number)(l)}function Vr(l){var h=xr(l,"string");return typeof h=="symbol"?h:h+""}function Z(l){"@babel/helpers - typeof";return Z=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(h){return typeof h}:function(h){return h&&typeof Symbol=="function"&&h.constructor===Symbol&&h!==Symbol.prototype?"symbol":typeof h},Z(l)}function gr(l,h){if(l){if(typeof l=="string")return Ar(l,h);var p={}.toString.call(l).slice(8,-1);return p==="Object"&&l.constructor&&(p=l.constructor.name),p==="Map"||p==="Set"?Array.from(l):p==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(p)?Ar(l,h):void 0}}var J={exports:{}},rr={},yr;function tr(){return yr||(yr=1,rr.validateOptions=function(h,p,A){if(h){var k=h?Object.keys(h):[],C=k.find(function(L){return!p.includes(L)});if(C)throw new Error('Object "'+A+'" contains an unknown option "'+C+'"');var s=p.find(function(L){return Object.prototype[L]&&!k.includes(L)});if(s)throw new Error('Object "'+A+'" contains an inherited option "'+s+'" which is not defined in the object itself but in its prototype. Only plain objects are allowed. Please remove the option from the prototype or override it with a value "undefined".');return h}},rr.workerOptsNames=["credentials","name","type"],rr.forkOptsNames=["cwd","detached","env","execPath","execArgv","gid","serialization","signal","killSignal","silent","stdio","uid","windowsVerbatimArguments","timeout"],rr.workerThreadOptsNames=["argv","env","eval","execArgv","stdin","stdout","stderr","workerData","trackUnmanagedFds","transferList","resourceLimits","name"]),rr}var q,lr;function wr(){return lr||(lr=1,q=`!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e="undefined"!=typeof globalThis?globalThis:e||self).worker=n()}(this,(function(){"use strict";function e(n){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(n)}function n(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var t={};var r=function(e,n){this.message=e,this.transfer=n},o={};function i(e,n){var t=this;if(!(this instanceof i))throw new SyntaxError("Constructor must be called with the new operator");if("function"!=typeof e)throw new SyntaxError("Function parameter handler(resolve, reject) missing");var r=[],o=[];this.resolved=!1,this.rejected=!1,this.pending=!0;var a=function(e,n){r.push(e),o.push(n)};this.then=function(e,n){return new i((function(t,r){var o=e?u(e,t,r):t,i=n?u(n,t,r):r;a(o,i)}),t)};var f=function(e){return t.resolved=!0,t.rejected=!1,t.pending=!1,r.forEach((function(n){n(e)})),a=function(n,t){n(e)},f=d=function(){},t},d=function(e){return t.resolved=!1,t.rejected=!0,t.pending=!1,o.forEach((function(n){n(e)})),a=function(n,t){t(e)},f=d=function(){},t};this.cancel=function(){return n?n.cancel():d(new s),t},this.timeout=function(e){if(n)n.timeout(e);else{var r=setTimeout((function(){d(new c("Promise timed out after "+e+" ms"))}),e);t.always((function(){clearTimeout(r)}))}return t},e((function(e){f(e)}),(function(e){d(e)}))}function u(e,n,t){return function(r){try{var o=e(r);o&&"function"==typeof o.then&&"function"==typeof o.catch?o.then(n,t):n(o)}catch(e){t(e)}}}function s(e){this.message=e||"promise cancelled",this.stack=(new Error).stack}function c(e){this.message=e||"timeout exceeded",this.stack=(new Error).stack}return i.prototype.catch=function(e){return this.then(null,e)},i.prototype.always=function(e){return this.then(e,e)},i.prototype.finally=function(e){var n=this,t=function(){return new i((function(e){return e()})).then(e).then((function(){return n}))};return this.then(t,t)},i.all=function(e){return new i((function(n,t){var r=e.length,o=[];r?e.forEach((function(e,i){e.then((function(e){o[i]=e,0==--r&&n(o)}),(function(e){r=0,t(e)}))})):n(o)}))},i.defer=function(){var e={};return e.promise=new i((function(n,t){e.resolve=n,e.reject=t})),e},s.prototype=new Error,s.prototype.constructor=Error,s.prototype.name="CancellationError",i.CancellationError=s,c.prototype=new Error,c.prototype.constructor=Error,c.prototype.name="TimeoutError",i.TimeoutError=c,o.Promise=i,function(n){var t=r,i=o.Promise,u="__workerpool-cleanup__",s={exit:function(){}},c={addAbortListener:function(e){s.abortListeners.push(e)},emit:s.emit};if("undefined"!=typeof self&&"function"==typeof postMessage&&"function"==typeof addEventListener)s.on=function(e,n){addEventListener(e,(function(e){n(e.data)}))},s.send=function(e,n){n?postMessage(e,n):postMessage(e)};else{if("undefined"==typeof process)throw new Error("Script must be executed as a worker");var a;try{a=require("worker_threads")}catch(n){if("object"!==e(n)||null===n||"MODULE_NOT_FOUND"!==n.code)throw n}if(a&&null!==a.parentPort){var f=a.parentPort;s.send=f.postMessage.bind(f),s.on=f.on.bind(f),s.exit=process.exit.bind(process)}else s.on=process.on.bind(process),s.send=function(e){process.send(e)},s.on("disconnect",(function(){process.exit(1)})),s.exit=process.exit.bind(process)}function d(e){return Object.getOwnPropertyNames(e).reduce((function(n,t){return Object.defineProperty(n,t,{value:e[t],enumerable:!0})}),{})}function l(e){return e&&"function"==typeof e.then&&"function"==typeof e.catch}s.methods={},s.methods.run=function(e,n){var t=new Function("return ("+e+").apply(this, arguments);");return t.worker=c,t.apply(t,n)},s.methods.methods=function(){return Object.keys(s.methods)},s.terminationHandler=void 0,s.abortListenerTimeout=1e3,s.abortListeners=[],s.terminateAndExit=function(e){var n=function(){s.exit(e)};if(!s.terminationHandler)return n();var t=s.terminationHandler(e);return l(t)?(t.then(n,n),t):(n(),new i((function(e,n){n(new Error("Worker terminating"))})))},s.cleanup=function(e){if(!s.abortListeners.length)return s.send({id:e,method:u,error:d(new Error("Worker terminating"))}),new i((function(e){e()}));var n,t=s.abortListeners.map((function(e){return e()})),r=new i((function(e,t){n=setTimeout((function(){t(new Error("Timeout occured waiting for abort handler, killing worker"))}),s.abortListenerTimeout)})),o=i.all(t).then((function(){clearTimeout(n),s.abortListeners.length||(s.abortListeners=[])}),(function(){clearTimeout(n),s.exit()}));return i.all([o,r]).then((function(){s.send({id:e,method:u,error:null})}),(function(n){s.send({id:e,method:u,error:n?d(n):null})}))};var p=null;s.on("message",(function(e){if("__workerpool-terminate__"===e)return s.terminateAndExit(0);if(e.method===u)return s.cleanup(e.id);try{var n=s.methods[e.method];if(!n)throw new Error('Unknown method "'+e.method+'"');p=e.id;var r=n.apply(n,e.params);l(r)?r.then((function(n){n instanceof t?s.send({id:e.id,result:n.message,error:null},n.transfer):s.send({id:e.id,result:n,error:null}),p=null})).catch((function(n){s.send({id:e.id,result:null,error:d(n)}),p=null})):(r instanceof t?s.send({id:e.id,result:r.message,error:null},r.transfer):s.send({id:e.id,result:r,error:null}),p=null)}catch(n){s.send({id:e.id,result:null,error:d(n)})}})),s.register=function(e,n){if(e)for(var t in e)e.hasOwnProperty(t)&&(s.methods[t]=e[t],s.methods[t].worker=c);n&&(s.terminationHandler=n.onTerminate,s.abortListenerTimeout=n.abortListenerTimeout||1e3),s.send("ready")},s.emit=function(e){if(p){if(e instanceof t)return void s.send({id:p,isEvent:!0,payload:e.message},e.transfer);s.send({id:p,isEvent:!0,payload:e})}},n.add=s.register,n.emit=s.emit}(t),n(t)}));
//# sourceMappingURL=worker.min.js.map
`),q}var nr;function F(){if(nr)return J.exports;nr=1;var l=mr(),h=l.Promise,p=hr,A=tr(),k=A.validateOptions,C=A.forkOptsNames,s=A.workerThreadOptsNames,L=A.workerOptsNames,R="__workerpool-terminate__",I="__workerpool-cleanup__";function V(){var E=v();if(!E)throw new Error("WorkerPool: workerType = 'thread' is not supported, Node >= 11.7.0 required");return E}function g(){if(typeof Worker!="function"&&((typeof Worker>"u"?"undefined":Z(Worker))!=="object"||typeof Worker.prototype.constructor!="function"))throw new Error("WorkerPool: Web Workers not supported")}function v(){try{return kr}catch(E){if(Z(E)==="object"&&E!==null&&E.code==="MODULE_NOT_FOUND")return null;throw E}}function u(){if(p.platform==="browser"){if(typeof Blob>"u")throw new Error("Blob not supported by the browser");if(!window.URL||typeof window.URL.createObjectURL!="function")throw new Error("URL.createObjectURL not supported by the browser");var E=new Blob([wr()],{type:"text/javascript"});return window.URL.createObjectURL(E)}else return __dirname+"/worker.js"}function y(E,x){if(x.workerType==="web")return g(),b(E,x.workerOpts,Worker);if(x.workerType==="thread")return d=V(),P(E,d,x);if(x.workerType==="process"||!x.workerType)return H(E,z(x),kr);if(p.platform==="browser")return g(),b(E,x.workerOpts,Worker);var d=v();return d?P(E,d,x):H(E,z(x),kr)}function b(E,x,d){k(x,L,"workerOpts");var w=new d(E,x);return w.isBrowserWorker=!0,w.on=function(j,W){this.addEventListener(j,function($){W($.data)})},w.send=function(j,W){this.postMessage(j,W)},w}function P(E,x,d){var w,j;k(d==null?void 0:d.workerThreadOpts,s,"workerThreadOpts");var W=new x.Worker(E,Nr({stdout:(w=d==null?void 0:d.emitStdStreams)!==null&&w!==void 0?w:!1,stderr:(j=d==null?void 0:d.emitStdStreams)!==null&&j!==void 0?j:!1},d==null?void 0:d.workerThreadOpts));return W.isWorkerThread=!0,W.send=function($,O){this.postMessage($,O)},W.kill=function(){return this.terminate(),!0},W.disconnect=function(){this.terminate()},d!=null&&d.emitStdStreams&&(W.stdout.on("data",function($){return W.emit("stdout",$)}),W.stderr.on("data",function($){return W.emit("stderr",$)})),W}function H(E,x,d){k(x.forkOpts,C,"forkOpts");var w=d.fork(E,x.forkArgs,x.forkOpts),j=w.send;return w.send=function(W){return j.call(w,W)},x.emitStdStreams&&(w.stdout.on("data",function(W){return w.emit("stdout",W)}),w.stderr.on("data",function(W){return w.emit("stderr",W)})),w.isChildProcess=!0,w}function z(E){E=E||{};var x=process.execArgv.join(" "),d=x.indexOf("--inspect")!==-1,w=x.indexOf("--debug-brk")!==-1,j=[];return d&&(j.push("--inspect="+E.debugPort),w&&j.push("--debug-brk")),process.execArgv.forEach(function(W){W.indexOf("--max-old-space-size")>-1&&j.push(W)}),Object.assign({},E,{forkArgs:E.forkArgs,forkOpts:Object.assign({},E.forkOpts,{execArgv:(E.forkOpts&&E.forkOpts.execArgv||[]).concat(j),stdio:E.emitStdStreams?"pipe":void 0})})}function K(E){for(var x=new Error(""),d=Object.keys(E),w=0;w<d.length;w++)x[d[w]]=E[d[w]];return x}function X(E,x){if(Object.keys(E.processing).length===1){var d=Object.values(E.processing)[0];d.options&&typeof d.options.on=="function"&&d.options.on(x)}}function ir(E,x){var d=this,w=x||{};this.script=E||u(),this.worker=y(this.script,w),this.debugPort=w.debugPort,this.forkOpts=w.forkOpts,this.forkArgs=w.forkArgs,this.workerOpts=w.workerOpts,this.workerThreadOpts=w.workerThreadOpts,this.workerTerminateTimeout=w.workerTerminateTimeout,E||(this.worker.ready=!0),this.requestQueue=[],this.worker.on("stdout",function(O){X(d,{stdout:O.toString()})}),this.worker.on("stderr",function(O){X(d,{stderr:O.toString()})}),this.worker.on("message",function(O){if(!d.terminated)if(typeof O=="string"&&O==="ready")d.worker.ready=!0,W();else{var B=O.id,U=d.processing[B];if(U!==void 0&&(O.isEvent?U.options&&typeof U.options.on=="function"&&U.options.on(O.payload):(delete d.processing[B],d.terminating===!0&&d.terminate(),O.error?U.resolver.reject(K(O.error)):U.resolver.resolve(O.result))),O.method===I){var M=d.tracking[O.id];M!==void 0&&(O.error?(clearTimeout(M.timeoutId),M.resolver.reject(K(O.error))):(d.tracking&&clearTimeout(M.timeoutId),M.resolver.resolve(M.result))),delete d.tracking[B]}}});function j(O){d.terminated=!0;for(var B in d.processing)d.processing[B]!==void 0&&d.processing[B].resolver.reject(O);d.processing=Object.create(null)}function W(){var O=ee(d.requestQueue.splice(0)),B;try{for(O.s();!(B=O.n()).done;){var U=B.value;d.worker.send(U.message,U.transfer)}}catch(M){O.e(M)}finally{O.f()}}var $=this.worker;this.worker.on("error",j),this.worker.on("exit",function(O,B){var U=`Workerpool Worker terminated Unexpectedly
`;U+="    exitCode: `"+O+"`\n",U+="    signalCode: `"+B+"`\n",U+="    workerpool.script: `"+d.script+"`\n",U+="    spawnArgs: `"+$.spawnargs+"`\n",U+="    spawnfile: `"+$.spawnfile+"`\n",U+="    stdout: `"+$.stdout+"`\n",U+="    stderr: `"+$.stderr+"`\n",j(new Error(U))}),this.processing=Object.create(null),this.tracking=Object.create(null),this.terminating=!1,this.terminated=!1,this.cleaning=!1,this.terminationHandler=null,this.lastId=0}return ir.prototype.methods=function(){return this.exec("methods")},ir.prototype.exec=function(E,x,d,w){d||(d=h.defer());var j=++this.lastId;this.processing[j]={id:j,resolver:d,options:w};var W={message:{id:j,method:E,params:x},transfer:w&&w.transfer};this.terminated?d.reject(new Error("Worker is terminated")):this.worker.ready?this.worker.send(W.message,W.transfer):this.requestQueue.push(W);var $=this;return d.promise.catch(function(O){if(O instanceof h.CancellationError||O instanceof h.TimeoutError)return $.tracking[j]={id:j,resolver:h.defer()},delete $.processing[j],$.tracking[j].resolver.promise=$.tracking[j].resolver.promise.catch(function(B){delete $.tracking[j];var U=$.terminateAndNotify(!0).then(function(){throw B},function(M){throw M});return U}),$.worker.send({id:j,method:I}),$.tracking[j].timeoutId=setTimeout(function(){$.tracking[j].resolver.reject(O)},$.workerTerminateTimeout),$.tracking[j].resolver.promise;throw O})},ir.prototype.busy=function(){return this.cleaning||Object.keys(this.processing).length>0},ir.prototype.terminate=function(E,x){var d=this;if(E){for(var w in this.processing)this.processing[w]!==void 0&&this.processing[w].resolver.reject(new Error("Worker terminated"));this.processing=Object.create(null)}for(var j=0,W=Object.values(d.tracking);j<W.length;j++){var $=W[j];clearTimeout($.timeoutId),$.resolver.reject(new Error("Worker Terminating"))}if(d.tracking=Object.create(null),typeof x=="function"&&(this.terminationHandler=x),this.busy())this.terminating=!0;else{var O=function(M){if(d.terminated=!0,d.cleaning=!1,d.worker!=null&&d.worker.removeAllListeners&&d.worker.removeAllListeners("message"),d.worker=null,d.terminating=!1,d.terminationHandler)d.terminationHandler(M,d);else if(M)throw M};if(this.worker)if(typeof this.worker.kill=="function"){if(this.worker.killed){O(new Error("worker already killed!"));return}var B=setTimeout(function(){d.worker&&d.worker.kill()},this.workerTerminateTimeout);this.worker.once("exit",function(){clearTimeout(B),d.worker&&(d.worker.killed=!0),O()}),this.worker.ready?this.worker.send(R):this.requestQueue.push({message:R}),this.cleaning=!0;return}else if(typeof this.worker.terminate=="function")this.worker.terminate(),this.worker.killed=!0;else throw new Error("Failed to terminate worker");O()}},ir.prototype.terminateAndNotify=function(E,x){var d=h.defer();return x&&d.promise.timeout(x),this.terminate(E,function(w,j){w?d.reject(w):d.resolve(j)}),d.promise},J.exports=ir,J.exports._tryRequireWorkerThreads=v,J.exports._setupProcessWorker=H,J.exports._setupBrowserWorker=b,J.exports._setupWorkerThreadWorker=P,J.exports.ensureWorkerThreads=V,J.exports}var br,jr;function Br(){if(jr)return br;jr=1;var l=65535;br=h;function h(){this.ports=Object.create(null),this.length=0}return h.prototype.nextAvailableStartingAt=function(p){for(;this.ports[p]===!0;)p++;if(p>=l)throw new Error("WorkerPool debug port limit reached: "+p+">= "+l);return this.ports[p]=!0,this.length++,p},h.prototype.releasePort=function(p){delete this.ports[p],this.length--},br}var Tr,Sr;function te(){if(Sr)return Tr;Sr=1;var l=mr(),h=l.Promise,p=F(),A=hr,k=Br(),C=new k;function s(g,v){typeof g=="string"?this.script=g||null:(this.script=null,v=g),this.workers=[],this.tasks=[],v=v||{},this.forkArgs=Object.freeze(v.forkArgs||[]),this.forkOpts=Object.freeze(v.forkOpts||{}),this.workerOpts=Object.freeze(v.workerOpts||{}),this.workerThreadOpts=Object.freeze(v.workerThreadOpts||{}),this.debugPortStart=v.debugPortStart||43210,this.nodeWorker=v.nodeWorker,this.workerType=v.workerType||v.nodeWorker||"auto",this.maxQueueSize=v.maxQueueSize||1/0,this.workerTerminateTimeout=v.workerTerminateTimeout||1e3,this.onCreateWorker=v.onCreateWorker||function(){return null},this.onTerminateWorker=v.onTerminateWorker||function(){return null},this.emitStdStreams=v.emitStdStreams||!1,v&&"maxWorkers"in v?(L(v.maxWorkers),this.maxWorkers=v.maxWorkers):this.maxWorkers=Math.max((A.cpus||4)-1,1),v&&"minWorkers"in v&&(v.minWorkers==="max"?this.minWorkers=this.maxWorkers:(R(v.minWorkers),this.minWorkers=v.minWorkers,this.maxWorkers=Math.max(this.minWorkers,this.maxWorkers)),this._ensureMinWorkers()),this._boundNext=this._next.bind(this),this.workerType==="thread"&&p.ensureWorkerThreads()}s.prototype.exec=function(g,v,u){if(v&&!Array.isArray(v))throw new TypeError('Array expected as argument "params"');if(typeof g=="string"){var y=h.defer();if(this.tasks.length>=this.maxQueueSize)throw new Error("Max queue size of "+this.maxQueueSize+" reached");var b=this.tasks,P={method:g,params:v,resolver:y,timeout:null,options:u};b.push(P);var H=y.promise.timeout;return y.promise.timeout=function(K){return b.indexOf(P)!==-1?(P.timeout=K,y.promise):H.call(y.promise,K)},this._next(),y.promise}else{if(typeof g=="function")return this.exec("run",[String(g),v],u);throw new TypeError('Function or string expected as argument "method"')}},s.prototype.proxy=function(){if(arguments.length>0)throw new Error("No arguments expected");var g=this;return this.exec("methods").then(function(v){var u={};return v.forEach(function(y){u[y]=function(){return g.exec(y,Array.prototype.slice.call(arguments))}}),u})},s.prototype._next=function(){if(this.tasks.length>0){var g=this._getWorker();if(g){var v=this,u=this.tasks.shift();if(u.resolver.promise.pending){var y=g.exec(u.method,u.params,u.resolver,u.options).then(v._boundNext).catch(function(){if(g.terminated)return v._removeWorker(g)}).then(function(){v._next()});typeof u.timeout=="number"&&y.timeout(u.timeout)}else v._next()}}},s.prototype._getWorker=function(){for(var g=this.workers,v=0;v<g.length;v++){var u=g[v];if(u.busy()===!1)return u}return g.length<this.maxWorkers?(u=this._createWorkerHandler(),g.push(u),u):null},s.prototype._removeWorker=function(g){var v=this;return C.releasePort(g.debugPort),this._removeWorkerFromList(g),this._ensureMinWorkers(),new h(function(u,y){g.terminate(!1,function(b){v.onTerminateWorker({forkArgs:g.forkArgs,forkOpts:g.forkOpts,workerThreadOpts:g.workerThreadOpts,script:g.script}),b?y(b):u(g)})})},s.prototype._removeWorkerFromList=function(g){var v=this.workers.indexOf(g);v!==-1&&this.workers.splice(v,1)},s.prototype.terminate=function(g,v){var u=this;this.tasks.forEach(function(z){z.resolver.reject(new Error("Pool terminated"))}),this.tasks.length=0;var y=function(K){C.releasePort(K.debugPort),this._removeWorkerFromList(K)},b=y.bind(this),P=[],H=this.workers.slice();return H.forEach(function(z){var K=z.terminateAndNotify(g,v).then(b).always(function(){u.onTerminateWorker({forkArgs:z.forkArgs,forkOpts:z.forkOpts,workerThreadOpts:z.workerThreadOpts,script:z.script})});P.push(K)}),h.all(P)},s.prototype.stats=function(){var g=this.workers.length,v=this.workers.filter(function(u){return u.busy()}).length;return{totalWorkers:g,busyWorkers:v,idleWorkers:g-v,pendingTasks:this.tasks.length,activeTasks:v}},s.prototype._ensureMinWorkers=function(){if(this.minWorkers)for(var g=this.workers.length;g<this.minWorkers;g++)this.workers.push(this._createWorkerHandler())},s.prototype._createWorkerHandler=function(){var g=this.onCreateWorker({forkArgs:this.forkArgs,forkOpts:this.forkOpts,workerOpts:this.workerOpts,workerThreadOpts:this.workerThreadOpts,script:this.script})||{};return new p(g.script||this.script,{forkArgs:g.forkArgs||this.forkArgs,forkOpts:g.forkOpts||this.forkOpts,workerOpts:g.workerOpts||this.workerOpts,workerThreadOpts:g.workerThreadOpts||this.workerThreadOpts,debugPort:C.nextAvailableStartingAt(this.debugPortStart),workerType:this.workerType,workerTerminateTimeout:this.workerTerminateTimeout,emitStdStreams:this.emitStdStreams})};function L(g){if(!I(g)||!V(g)||g<1)throw new TypeError("Option maxWorkers must be an integer number >= 1")}function R(g){if(!I(g)||!V(g)||g<0)throw new TypeError("Option minWorkers must be an integer number >= 0")}function I(g){return typeof g=="number"}function V(g){return Math.round(g)==g}return Tr=s,Tr}var Rr={},Cr,or;function vr(){if(or)return Cr;or=1;function l(h,p){this.message=h,this.transfer=p}return Cr=l,Cr}var qr;function zr(){return qr||(qr=1,function(l){var h=vr(),p=mr().Promise,A="__workerpool-terminate__",k="__workerpool-cleanup__",C=1e3,s={exit:function(){}},L={addAbortListener:function(y){s.abortListeners.push(y)},emit:s.emit};if(typeof self<"u"&&typeof postMessage=="function"&&typeof addEventListener=="function")s.on=function(u,y){addEventListener(u,function(b){y(b.data)})},s.send=function(u,y){y?postMessage(u,y):postMessage(u)};else if(typeof process<"u"){var R;try{R=kr}catch(u){if(!(Z(u)==="object"&&u!==null&&u.code==="MODULE_NOT_FOUND"))throw u}if(R&&R.parentPort!==null){var I=R.parentPort;s.send=I.postMessage.bind(I),s.on=I.on.bind(I),s.exit=process.exit.bind(process)}else s.on=process.on.bind(process),s.send=function(u){process.send(u)},s.on("disconnect",function(){process.exit(1)}),s.exit=process.exit.bind(process)}else throw new Error("Script must be executed as a worker");function V(u){return Object.getOwnPropertyNames(u).reduce(function(y,b){return Object.defineProperty(y,b,{value:u[b],enumerable:!0})},{})}function g(u){return u&&typeof u.then=="function"&&typeof u.catch=="function"}s.methods={},s.methods.run=function(y,b){var P=new Function("return ("+y+").apply(this, arguments);");return P.worker=L,P.apply(P,b)},s.methods.methods=function(){return Object.keys(s.methods)},s.terminationHandler=void 0,s.abortListenerTimeout=C,s.abortListeners=[],s.terminateAndExit=function(u){var y=function(){s.exit(u)};if(!s.terminationHandler)return y();var b=s.terminationHandler(u);return g(b)?(b.then(y,y),b):(y(),new p(function(P,H){H(new Error("Worker terminating"))}))},s.cleanup=function(u){if(!s.abortListeners.length)return s.send({id:u,method:k,error:V(new Error("Worker terminating"))}),new p(function(X){X()});var y=function(){s.exit()},b=function(){s.abortListeners.length||(s.abortListeners=[])},P=s.abortListeners.map(function(X){return X()}),H,z=new p(function(X,ir){H=setTimeout(function(){ir(new Error("Timeout occured waiting for abort handler, killing worker"))},s.abortListenerTimeout)}),K=p.all(P).then(function(){clearTimeout(H),b()},function(){clearTimeout(H),y()});return p.all([K,z]).then(function(){s.send({id:u,method:k,error:null})},function(X){s.send({id:u,method:k,error:X?V(X):null})})};var v=null;s.on("message",function(u){if(u===A)return s.terminateAndExit(0);if(u.method===k)return s.cleanup(u.id);try{var y=s.methods[u.method];if(y){v=u.id;var b=y.apply(y,u.params);g(b)?b.then(function(P){P instanceof h?s.send({id:u.id,result:P.message,error:null},P.transfer):s.send({id:u.id,result:P,error:null}),v=null}).catch(function(P){s.send({id:u.id,result:null,error:V(P)}),v=null}):(b instanceof h?s.send({id:u.id,result:b.message,error:null},b.transfer):s.send({id:u.id,result:b,error:null}),v=null)}else throw new Error('Unknown method "'+u.method+'"')}catch(P){s.send({id:u.id,result:null,error:V(P)})}}),s.register=function(u,y){if(u)for(var b in u)u.hasOwnProperty(b)&&(s.methods[b]=u[b],s.methods[b].worker=L);y&&(s.terminationHandler=y.onTerminate,s.abortListenerTimeout=y.abortListenerTimeout||C),s.send("ready")},s.emit=function(u){if(v){if(u instanceof h){s.send({id:v,isEvent:!0,payload:u.message},u.transfer);return}s.send({id:v,isEvent:!0,payload:u})}},l.add=s.register,l.emit=s.emit}(Rr)),Rr}var Qr=hr.platform,Fr=hr.isMainThread,ne=hr.cpus;function oe(l,h){var p=te();return new p(l,h)}var ie=D.pool=oe;function ae(l,h){var p=zr();p.add(l,h)}var se=D.worker=ae;function ue(l){var h=zr();h.emit(l)}var fe=D.workerEmit=ue,Gr=mr(),Kr=Gr.Promise,Xr=D.Promise=Kr,ce=D.Transfer=vr(),Yr=D.platform=Qr,le=D.isMainThread=Fr,$r=D.cpus=ne;f.Promise=Xr,f.Transfer=ce,f.cpus=$r,f.default=D,f.isMainThread=le,f.platform=Yr,f.pool=ie,f.worker=se,f.workerEmit=fe,Object.defineProperty(f,"__esModule",{value:!0})})}(er,er.exports)),er.exports}var ze=qe(),Dr={};let Ir=null;async function Qe(Y,G){await be(),console.log("worker jsEncodeImage inputs",Y,G);const f=Dr.jsEncodeImages(Y,G);return console.log("worker jsEncodeImage send",f),f}async function Ge(Y){await be();const G=Dr.jsDecodeImage(Y);return console.log("worker jsDecodeImage send",G),G}async function be(){Ir||(Ir=pr(Dr)),await Ir}async function Ke(){Ir=null,Dr={}}ze.worker({jsEncodeImages:Qe,jsDecodeImage:Ge,prune:Ke})})();
