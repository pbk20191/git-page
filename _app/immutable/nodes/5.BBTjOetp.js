import{t as Ct,a as kt}from"../chunks/CtYR2VL8.js";import{p as Bt,aa as k,Y as _t,G as bt,s as n,c as l,t as Nt,K as t,a as Ft,W as v,r as s}from"../chunks/BiaDghIV.js";import{s as Dt}from"../chunks/B-R2J0SN.js";import{s as at}from"../chunks/CL-5-TAf.js";import{s as xt,r as y}from"../chunks/Cgoudy-_.js";import{d as Et,e as Ot}from"../chunks/gFQPrapg.js";import{a as M,J as At}from"../chunks/Dazn8mIu.js";import{b as nt,F as jt}from"../chunks/tOPgWaih.js";import{b as wt}from"../chunks/BlZKb0-f.js";import{o as Gt}from"../chunks/BGpdg9QL.js";import{t as yt,w as Jt}from"../chunks/4eif3qM-.js";const Lt=""+new URL("../workers/XcodeNinePatchRenderer-DSIeq7jB.js",import.meta.url).href;var Ut=(u,f)=>f(u,"left"),Xt=(u,f)=>f(u,"right"),Yt=(u,f)=>f(u,"top"),qt=(u,f)=>f(u,"bottom"),Kt=Ct(`<main class="container" style="max-width: 980px; margin: 24px auto; padding: 16px;"><h1 style="font: 600 20px/1.2 system-ui, -apple-system, sans-serif; margin-bottom: 16px;">iOS Nine-Patch Resizer (OffscreenCanvas + Comlink)</h1> <section style="display: grid; grid-template-columns: 1fr; gap: 12px; margin-bottom: 12px;"><label>PNG File <input name="xcode_png_ninepatch_input" type="file" accept="image/png"></label> <div style="display:flex; gap:12px; flex-wrap:wrap;"><label>Source Scale <select name="source_scale"><option>1x</option><option>2x</option><option>3x</option></select></label> <label>Resizing Mode <select name="resizing_mode"><option>9-part</option><option>3-part-horizontal</option><option>3-part-vertical</option></select></label> <label>Center Mode <select name="center_mode"><option>stretch</option><option>tile</option></select></label> <button>Export ResizingInfo</button></div></section> <section><canvas width="1" height="1" style=" height: auto; image-rendering: crisp-edges; border: 1px solid #ddd; border-radius: 8px;"></canvas> <div style="margin-top:8px; font: 12px/1.3 ui-monospace, SFMono-Regular, Menlo, monospace;"> </div> <fieldset style="
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px 16px;
    border: 1px solid #ccc;
    border-radius: 8px;
    padding: 8px 12px;
  "><label style="display: flex; flex-direction: column;">Left <input name="left_inset" type="number" min="0" step="1"></label> <label style="display: flex; flex-direction: column;">Right <input name="right_inset" type="number" min="0" step="1"></label> <label style="display: flex; flex-direction: column;">Top <input name="top_inset" type="number" min="0" step="1"></label> <label style="display: flex; flex-direction: column;">Bottom <input name="bottom_inset" type="number" min="0" step="1"></label></fieldset></section> <section><h6>Preview</h6> <fieldset style=" display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px 16px;
    border: 1px solid #ccc;
    border-radius: 8px;
    padding: 8px 12px;"><label>Preview Width <input type="number" name="preview_width"></label> <label>Preview Height <input type="number" name="preview_height"></label></fieldset> <canvas></canvas></section></main>`);function le(u,f){Bt(f,!0);let b,g=k(3),c=k("9-part"),z=k("stretch"),B=null,a=k(_t({left:0,right:0,top:0,bottom:0})),d=!1,S=null,i=null,W,m=_t({w:10,h:10});Gt(()=>{S==null||S.terminate(),S=null,i=null});async function Mt(){if(i)return i;const e=new Worker(Lt,{type:"module"});S=e,i=Jt(e);const o=b.transferControlToOffscreen();return await i.attach(yt(o,[o])),i}async function St(e){var dt;const p=(dt=e.target.files)==null?void 0:dt[0];if(!p)return;if(p.type!=="image/png"){alert("Please select a PNG file");return}B=p.name.replace(/@[\dx]+(?=\.png$)|\.png$/g,""),p.name.endsWith("@3x.png")?v(g,3):p.name.endsWith("@2x.png")?v(g,2):p.name.endsWith("@1x.png")&&v(g,1);const r=await createImageBitmap(p,{colorSpaceConversion:"none",premultiplyAlpha:"premultiply"}),_=await Mt();await _.setSource(yt(r,[r]),t(g));const h=await _.getState();v(a,{left:Math.round(h.canvasW*.2),right:Math.round(h.canvasW*.2),top:Math.round(h.canvasH*.2),bottom:Math.round(h.canvasH*.2)},!0),m.h=h.canvasH,m.w=h.canvasW,await _.setInsets(at(t(a)),"right","bottom"),await x()}async function x(){var o;if(!i)return;let e=await i.createBitmap(W.width,W.height);(o=W.getContext("bitmaprenderer"))==null||o.transferFromImageBitmap(e)}async function Wt(){if(!i)return;await i.setScale(t(g));const e=await i.getState();t(a).left=Math.min(t(a).left,e.canvasW-1),t(a).right=Math.min(t(a).right,e.canvasW-1),t(a).top=Math.min(t(a).top,e.canvasH-1),t(a).bottom=Math.min(t(a).bottom,e.canvasH-1),await i.setInsets(at(t(a)),"right","bottom"),await x()}function it(e){const o=b.getBoundingClientRect(),p=Math.max(0,Math.min(e.clientX-o.left,o.width)),r=Math.max(0,Math.min(e.clientY-o.top,o.height)),_=b.width/o.width,h=b.height/o.height;return{x:Math.round(p*_),y:Math.round(r*h)}}async function zt(e){if(!i)return;const{x:o,y:p}=it(e),r=await i.queryNearestEdge(o,p);t(c)=="3-part-horizontal"&&(r==="top"||r==="bottom")||t(c)=="3-part-vertical"&&(r==="left"||r==="right")||(d=r,await ot(e))}async function ot(e){if(!d||!i)return;const{x:o,y:p}=it(e),r=await i.getState();d==="left"?t(a).left=Math.max(0,Math.min(o,r.canvasW-1)):d==="right"?t(a).right=Math.max(0,Math.min(r.canvasW-o,r.canvasW-1)):d==="top"?t(a).top=Math.max(0,Math.min(p,r.canvasH-1)):d==="bottom"&&(t(a).bottom=Math.max(0,Math.min(r.canvasH-p,r.canvasH-1))),t(a).left+t(a).right>=r.canvasW&&(t(a).right=Math.max(0,r.canvasW-t(a).left-1)),t(a).top+t(a).bottom>=r.canvasH&&(t(a).bottom=Math.max(0,r.canvasH-t(a).top-1)),await i.setInsets(at(t(a))),await x()}function rt(){d=!1}async function It(){if(!i||!B)return;const e=B,o=await i.exportAsset(e),p=new At,r=p.folder(`${e}.imageset`);r.file(`${e}@3x.png`,o.image3x),r.file(`${e}@2x.png`,o.image2x),r.file(`${e}@1x.png`,o.image1x),r.file("Contents.json",JSON.stringify(o.contents));const _=await p.generateAsync({type:"blob"});jt.saveAs(_,"Demo.zip")}function $t(){return t(c)==="3-part-horizontal"?`
        left:${t(a).left}, right:${t(a).right}
        `:t(c)==="3-part-vertical"?`
        top:${t(a).top}, bottom:${t(a).bottom}
        `:`
    left:${t(a).left}, right:${t(a).right}
    top:${t(a).top}, bottom:${t(a).bottom}
    `}bt(()=>{t(c),t(z),i&&i.setMode(t(c),t(z)).then(async()=>{await x()})});async function I(e,o){i&&(o==="left"?await i.setInsets({left:t(a).left},"right","bottom"):o==="right"?await i.setInsets({right:t(a).right},"left","bottom"):o==="bottom"?await i.setInsets({bottom:t(a).bottom},"right","top"):o==="top"&&await i.setInsets({top:t(a).top},"right","bottom"),v(a,(await i.getState()).insets,!0),await x())}bt(()=>{m.w,m.h,i&&i.getState().then(async()=>{await x()})});var N=Kt(),F=n(l(N),2),D=l(F),Pt=n(l(D));Pt.__change=St,s(D);var lt=n(D,2),E=l(lt),$=n(l(E));$.__change=Wt;var O=l($);O.value=(O.__value=1)==null?"":1;var A=n(O);A.value=(A.__value=2)==null?"":2;var st=n(A);st.value=(st.__value=3)==null?"":3,s($),s(E);var j=n(E,2),G=n(l(j)),J=l(G);J.value=(J.__value="9-part")==null?"":"9-part";var L=n(J);L.value=(L.__value="3-part-horizontal")==null?"":"3-part-horizontal";var pt=n(L);pt.value=(pt.__value="3-part-vertical")==null?"":"3-part-vertical",s(G),s(j);var U=n(j,2),X=n(l(U)),Y=l(X);Y.value=(Y.__value="stretch")==null?"":"stretch";var ct=n(Y);ct.value=(ct.__value="tile")==null?"":"tile",s(X),s(U);var Rt=n(U,2);Rt.__click=It,s(lt),s(F);var q=n(F,2),w=l(q);w.__mousedown=zt,w.__mousemove=ot,w.__mouseup=rt,wt(w,e=>b=e,()=>b);var K=n(w,2),Ht=l(K);s(K);var mt=n(K,2),T=l(mt),P=n(l(T));y(P),P.__change=[Ut,I],s(T);var Z=n(T,2),R=n(l(Z));y(R),R.__change=[Xt,I],s(Z);var Q=n(Z,2),H=n(l(Q));y(H),H.__change=[Yt,I],s(Q);var ut=n(Q,2),C=n(l(ut));y(C),C.__change=[qt,I],s(ut),s(mt),s(q);var ft=n(q,2),V=n(l(ft),2),tt=l(V),ht=n(l(tt));y(ht),s(tt);var vt=n(tt,2),gt=n(l(vt));y(gt),s(vt),s(V);var et=n(V,2);wt(et,e=>W=e,()=>W),s(ft),s(N),Nt(e=>{Dt(Ht,`insets: ${e??""}`),P.disabled=t(c)=="3-part-vertical",R.disabled=t(c)=="3-part-vertical",H.disabled=t(c)=="3-part-horizontal",C.disabled=t(c)=="3-part-horizontal",xt(et,"width",m.w),xt(et,"height",m.h)},[$t]),nt($,()=>t(g),e=>v(g,e)),nt(G,()=>t(c),e=>v(c,e)),nt(X,()=>t(z),e=>v(z,e)),Ot("mouseleave",w,rt),M(P,()=>t(a).left,e=>t(a).left=e),M(R,()=>t(a).right,e=>t(a).right=e),M(H,()=>t(a).top,e=>t(a).top=e),M(C,()=>t(a).bottom,e=>t(a).bottom=e),M(ht,()=>m.w,e=>m.w=e),M(gt,()=>m.h,e=>m.h=e),kt(u,N),Ft()}Et(["change","click","mousedown","mousemove","mouseup"]);export{le as component};
