import{t as he,a as Ae}from"../chunks/BgNA64u3.js";import"../chunks/DdPMUxxI.js";import{p as ze,a as Xe,$ as Je,s as oe,c as be,G as H,a5 as Oe,_ as pe,r as Ee,av as _e,t as Ke}from"../chunks/BdRdJ0v6.js";import{e as Te}from"../chunks/W8vzRZW0.js";import{h as Ve}from"../chunks/qA1KspwQ.js";import{i as Ye}from"../chunks/D_9udqtK.js";import{s as er}from"../chunks/DZAViwko.js";import{b as rr}from"../chunks/BotJaVbN.js";import{i as tr}from"../chunks/u5HHrYAV.js";import{a as xe}from"../chunks/COZiNiyx.js";function nr(B){if(Object.prototype.hasOwnProperty.call(B,"__esModule"))return B;var Q=B.default;if(typeof Q=="function"){var _=function T(){return this instanceof T?Reflect.construct(Q,arguments,this.constructor):Q.apply(this,arguments)};_.prototype=Q.prototype}else _={};return Object.defineProperty(_,"__esModule",{value:!0}),Object.keys(B).forEach(function(T){var j=Object.getOwnPropertyDescriptor(B,T);Object.defineProperty(_,T,j.get?j:{enumerable:!0,get:function(){return B[T]}})}),_}var V={exports:{}};const or={},ir=Object.freeze(Object.defineProperty({__proto__:null,default:or},Symbol.toStringTag,{value:"Module"})),X=nr(ir);/**
 * workerpool.js
 * https://github.com/josdejong/workerpool
 *
 * Offload tasks to a pool of workers on node.js and in the browser.
 *
 * @version 9.2.0
 * @date    2024-10-11
 *
 * @license
 * Copyright (C) 2014-2022 Jos de Jong <wjosdejong@gmail.com>
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not
 * use this file except in compliance with the License. You may obtain a copy
 * of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
 * License for the specific language governing permissions and limitations under
 * the License.
 */var sr=V.exports,We;function ar(){return We||(We=1,function(B,Q){(function(_,T){T(Q)})(sr,function(_){var T={},j={exports:{}};(function(t){var s=function(c){return typeof c<"u"&&c.versions!=null&&c.versions.node!=null&&c+""=="[object process]"};t.exports.isNode=s,t.exports.platform=typeof process<"u"&&s(process)?"node":"browser";var i=t.exports.platform==="node"&&X;t.exports.isMainThread=t.exports.platform==="node"?(!i||i.isMainThread)&&!process.connected:typeof Window<"u",t.exports.cpus=t.exports.platform==="browser"?self.navigator.hardwareConcurrency:X.cpus().length})(j);var I=j.exports,J={},Y;function G(){if(Y)return J;Y=1;function t(c,y){var e=this;if(!(this instanceof t))throw new SyntaxError("Constructor must be called with the new operator");if(typeof c!="function")throw new SyntaxError("Function parameter handler(resolve, reject) missing");var E=[],w=[];this.resolved=!1,this.rejected=!1,this.pending=!0;var W=function(r,u){E.push(r),w.push(u)};this.then=function(o,r){return new t(function(u,l){var v=o?s(o,u,l):u,L=r?s(r,u,l):l;W(v,L)},e)};var P=function(r){return e.resolved=!0,e.rejected=!1,e.pending=!1,E.forEach(function(u){u(r)}),W=function(l,v){l(r)},P=a=function(){},e},a=function(r){return e.resolved=!1,e.rejected=!0,e.pending=!1,w.forEach(function(u){u(r)}),W=function(l,v){v(r)},P=a=function(){},e};this.cancel=function(){return y?y.cancel():a(new i),e},this.timeout=function(o){if(y)y.timeout(o);else{var r=setTimeout(function(){a(new p("Promise timed out after "+o+" ms"))},o);e.always(function(){clearTimeout(r)})}return e},c(function(o){P(o)},function(o){a(o)})}function s(c,y,e){return function(E){try{var w=c(E);w&&typeof w.then=="function"&&typeof w.catch=="function"?w.then(y,e):y(w)}catch(W){e(W)}}}t.prototype.catch=function(c){return this.then(null,c)},t.prototype.always=function(c){return this.then(c,c)},t.prototype.finally=function(c){var y=this,e=function(){return new t(function(w){return w()}).then(c).then(function(){return y})};return this.then(e,e)},t.all=function(c){return new t(function(y,e){var E=c.length,w=[];E?c.forEach(function(W,P){W.then(function(a){w[P]=a,E--,E==0&&y(w)},function(a){E=0,e(a)})}):y(w)})},t.defer=function(){var c={};return c.promise=new t(function(y,e){c.resolve=y,c.reject=e}),c};function i(c){this.message=c||"promise cancelled",this.stack=new Error().stack}i.prototype=new Error,i.prototype.constructor=Error,i.prototype.name="CancellationError",t.CancellationError=i;function p(c){this.message=c||"timeout exceeded",this.stack=new Error().stack}return p.prototype=new Error,p.prototype.constructor=Error,p.prototype.name="TimeoutError",t.TimeoutError=p,J.Promise=t,J}function ee(t,s){(s==null||s>t.length)&&(s=t.length);for(var i=0,p=Array(s);i<s;i++)p[i]=t[i];return p}function ie(t,s){var i=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=ae(t))||s){i&&(t=i);var p=0,c=function(){};return{s:c,n:function(){return p>=t.length?{done:!0}:{done:!1,value:t[p++]}},e:function(w){throw w},f:c}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var y,e=!0,E=!1;return{s:function(){i=i.call(t)},n:function(){var w=i.next();return e=w.done,w},e:function(w){E=!0,y=w},f:function(){try{e||i.return==null||i.return()}finally{if(E)throw y}}}}function se(t,s,i){return(s=ne(s))in t?Object.defineProperty(t,s,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[s]=i,t}function z(t,s){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(t);s&&(p=p.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,p)}return i}function re(t){for(var s=1;s<arguments.length;s++){var i=arguments[s]!=null?arguments[s]:{};s%2?z(Object(i),!0).forEach(function(p){se(t,p,i[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):z(Object(i)).forEach(function(p){Object.defineProperty(t,p,Object.getOwnPropertyDescriptor(i,p))})}return t}function te(t,s){if(typeof t!="object"||!t)return t;var i=t[Symbol.toPrimitive];if(i!==void 0){var p=i.call(t,s);if(typeof p!="object")return p;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(t)}function ne(t){var s=te(t,"string");return typeof s=="symbol"?s:s+""}function Z(t){"@babel/helpers - typeof";return Z=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(s){return typeof s}:function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},Z(t)}function ae(t,s){if(t){if(typeof t=="string")return ee(t,s);var i={}.toString.call(t).slice(8,-1);return i==="Object"&&t.constructor&&(i=t.constructor.name),i==="Map"||i==="Set"?Array.from(t):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?ee(t,s):void 0}}var g={exports:{}},b={},N;function S(){return N||(N=1,b.validateOptions=function(s,i,p){if(s){var c=s?Object.keys(s):[],y=c.find(function(E){return!i.includes(E)});if(y)throw new Error('Object "'+p+'" contains an unknown option "'+y+'"');var e=i.find(function(E){return Object.prototype[E]&&!c.includes(E)});if(e)throw new Error('Object "'+p+'" contains an inherited option "'+e+'" which is not defined in the object itself but in its prototype. Only plain objects are allowed. Please remove the option from the prototype or override it with a value "undefined".');return s}},b.workerOptsNames=["credentials","name","type"],b.forkOptsNames=["cwd","detached","env","execPath","execArgv","gid","serialization","signal","killSignal","silent","stdio","uid","windowsVerbatimArguments","timeout"],b.workerThreadOptsNames=["argv","env","eval","execArgv","stdin","stdout","stderr","workerData","trackUnmanagedFds","transferList","resourceLimits","name"]),b}var F,$;function ue(){return $||($=1,F=`!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e="undefined"!=typeof globalThis?globalThis:e||self).worker=n()}(this,(function(){"use strict";function e(n){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(n)}function n(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var t={};var r=function(e,n){this.message=e,this.transfer=n},o={};function i(e,n){var t=this;if(!(this instanceof i))throw new SyntaxError("Constructor must be called with the new operator");if("function"!=typeof e)throw new SyntaxError("Function parameter handler(resolve, reject) missing");var r=[],o=[];this.resolved=!1,this.rejected=!1,this.pending=!0;var a=function(e,n){r.push(e),o.push(n)};this.then=function(e,n){return new i((function(t,r){var o=e?u(e,t,r):t,i=n?u(n,t,r):r;a(o,i)}),t)};var f=function(e){return t.resolved=!0,t.rejected=!1,t.pending=!1,r.forEach((function(n){n(e)})),a=function(n,t){n(e)},f=d=function(){},t},d=function(e){return t.resolved=!1,t.rejected=!0,t.pending=!1,o.forEach((function(n){n(e)})),a=function(n,t){t(e)},f=d=function(){},t};this.cancel=function(){return n?n.cancel():d(new s),t},this.timeout=function(e){if(n)n.timeout(e);else{var r=setTimeout((function(){d(new c("Promise timed out after "+e+" ms"))}),e);t.always((function(){clearTimeout(r)}))}return t},e((function(e){f(e)}),(function(e){d(e)}))}function u(e,n,t){return function(r){try{var o=e(r);o&&"function"==typeof o.then&&"function"==typeof o.catch?o.then(n,t):n(o)}catch(e){t(e)}}}function s(e){this.message=e||"promise cancelled",this.stack=(new Error).stack}function c(e){this.message=e||"timeout exceeded",this.stack=(new Error).stack}return i.prototype.catch=function(e){return this.then(null,e)},i.prototype.always=function(e){return this.then(e,e)},i.prototype.finally=function(e){var n=this,t=function(){return new i((function(e){return e()})).then(e).then((function(){return n}))};return this.then(t,t)},i.all=function(e){return new i((function(n,t){var r=e.length,o=[];r?e.forEach((function(e,i){e.then((function(e){o[i]=e,0==--r&&n(o)}),(function(e){r=0,t(e)}))})):n(o)}))},i.defer=function(){var e={};return e.promise=new i((function(n,t){e.resolve=n,e.reject=t})),e},s.prototype=new Error,s.prototype.constructor=Error,s.prototype.name="CancellationError",i.CancellationError=s,c.prototype=new Error,c.prototype.constructor=Error,c.prototype.name="TimeoutError",i.TimeoutError=c,o.Promise=i,function(n){var t=r,i=o.Promise,u="__workerpool-cleanup__",s={exit:function(){}},c={addAbortListener:function(e){s.abortListeners.push(e)},emit:s.emit};if("undefined"!=typeof self&&"function"==typeof postMessage&&"function"==typeof addEventListener)s.on=function(e,n){addEventListener(e,(function(e){n(e.data)}))},s.send=function(e,n){n?postMessage(e,n):postMessage(e)};else{if("undefined"==typeof process)throw new Error("Script must be executed as a worker");var a;try{a=require("worker_threads")}catch(n){if("object"!==e(n)||null===n||"MODULE_NOT_FOUND"!==n.code)throw n}if(a&&null!==a.parentPort){var f=a.parentPort;s.send=f.postMessage.bind(f),s.on=f.on.bind(f),s.exit=process.exit.bind(process)}else s.on=process.on.bind(process),s.send=function(e){process.send(e)},s.on("disconnect",(function(){process.exit(1)})),s.exit=process.exit.bind(process)}function d(e){return Object.getOwnPropertyNames(e).reduce((function(n,t){return Object.defineProperty(n,t,{value:e[t],enumerable:!0})}),{})}function l(e){return e&&"function"==typeof e.then&&"function"==typeof e.catch}s.methods={},s.methods.run=function(e,n){var t=new Function("return ("+e+").apply(this, arguments);");return t.worker=c,t.apply(t,n)},s.methods.methods=function(){return Object.keys(s.methods)},s.terminationHandler=void 0,s.abortListenerTimeout=1e3,s.abortListeners=[],s.terminateAndExit=function(e){var n=function(){s.exit(e)};if(!s.terminationHandler)return n();var t=s.terminationHandler(e);return l(t)?(t.then(n,n),t):(n(),new i((function(e,n){n(new Error("Worker terminating"))})))},s.cleanup=function(e){if(!s.abortListeners.length)return s.send({id:e,method:u,error:d(new Error("Worker terminating"))}),new i((function(e){e()}));var n,t=s.abortListeners.map((function(e){return e()})),r=new i((function(e,t){n=setTimeout((function(){t(new Error("Timeout occured waiting for abort handler, killing worker"))}),s.abortListenerTimeout)})),o=i.all(t).then((function(){clearTimeout(n),s.abortListeners.length||(s.abortListeners=[])}),(function(){clearTimeout(n),s.exit()}));return i.all([o,r]).then((function(){s.send({id:e,method:u,error:null})}),(function(n){s.send({id:e,method:u,error:n?d(n):null})}))};var p=null;s.on("message",(function(e){if("__workerpool-terminate__"===e)return s.terminateAndExit(0);if(e.method===u)return s.cleanup(e.id);try{var n=s.methods[e.method];if(!n)throw new Error('Unknown method "'+e.method+'"');p=e.id;var r=n.apply(n,e.params);l(r)?r.then((function(n){n instanceof t?s.send({id:e.id,result:n.message,error:null},n.transfer):s.send({id:e.id,result:n,error:null}),p=null})).catch((function(n){s.send({id:e.id,result:null,error:d(n)}),p=null})):(r instanceof t?s.send({id:e.id,result:r.message,error:null},r.transfer):s.send({id:e.id,result:r,error:null}),p=null)}catch(n){s.send({id:e.id,result:null,error:d(n)})}})),s.register=function(e,n){if(e)for(var t in e)e.hasOwnProperty(t)&&(s.methods[t]=e[t],s.methods[t].worker=c);n&&(s.terminationHandler=n.onTerminate,s.abortListenerTimeout=n.abortListenerTimeout||1e3),s.send("ready")},s.emit=function(e){if(p){if(e instanceof t)return void s.send({id:p,isEvent:!0,payload:e.message},e.transfer);s.send({id:p,isEvent:!0,payload:e})}},n.add=s.register,n.emit=s.emit}(t),n(t)}));
//# sourceMappingURL=worker.min.js.map
`),F}var K;function je(){if(K)return g.exports;K=1;var t=G(),s=t.Promise,i=I,p=S(),c=p.validateOptions,y=p.forkOptsNames,e=p.workerThreadOptsNames,E=p.workerOptsNames,w="__workerpool-terminate__",W="__workerpool-cleanup__";function P(){var f=o();if(!f)throw new Error("WorkerPool: workerType = 'thread' is not supported, Node >= 11.7.0 required");return f}function a(){if(typeof Worker!="function"&&((typeof Worker>"u"?"undefined":Z(Worker))!=="object"||typeof Worker.prototype.constructor!="function"))throw new Error("WorkerPool: Web Workers not supported")}function o(){try{return X}catch(f){if(Z(f)==="object"&&f!==null&&f.code==="MODULE_NOT_FOUND")return null;throw f}}function r(){if(i.platform==="browser"){if(typeof Blob>"u")throw new Error("Blob not supported by the browser");if(!window.URL||typeof window.URL.createObjectURL!="function")throw new Error("URL.createObjectURL not supported by the browser");var f=new Blob([ue()],{type:"text/javascript"});return window.URL.createObjectURL(f)}else return __dirname+"/worker.js"}function u(f,A){if(A.workerType==="web")return a(),l(f,A.workerOpts,Worker);if(A.workerType==="thread")return n=P(),v(f,n,A);if(A.workerType==="process"||!A.workerType)return L(f,C(A),X);if(i.platform==="browser")return a(),l(f,A.workerOpts,Worker);var n=o();return n?v(f,n,A):L(f,C(A),X)}function l(f,A,n){c(A,E,"workerOpts");var d=new n(f,A);return d.isBrowserWorker=!0,d.on=function(h,k){this.addEventListener(h,function(O){k(O.data)})},d.send=function(h,k){this.postMessage(h,k)},d}function v(f,A,n){var d,h;c(n==null?void 0:n.workerThreadOpts,e,"workerThreadOpts");var k=new A.Worker(f,re({stdout:(d=n==null?void 0:n.emitStdStreams)!==null&&d!==void 0?d:!1,stderr:(h=n==null?void 0:n.emitStdStreams)!==null&&h!==void 0?h:!1},n==null?void 0:n.workerThreadOpts));return k.isWorkerThread=!0,k.send=function(O,m){this.postMessage(O,m)},k.kill=function(){return this.terminate(),!0},k.disconnect=function(){this.terminate()},n!=null&&n.emitStdStreams&&(k.stdout.on("data",function(O){return k.emit("stdout",O)}),k.stderr.on("data",function(O){return k.emit("stderr",O)})),k}function L(f,A,n){c(A.forkOpts,y,"forkOpts");var d=n.fork(f,A.forkArgs,A.forkOpts),h=d.send;return d.send=function(k){return h.call(d,k)},A.emitStdStreams&&(d.stdout.on("data",function(k){return d.emit("stdout",k)}),d.stderr.on("data",function(k){return d.emit("stderr",k)})),d.isChildProcess=!0,d}function C(f){f=f||{};var A=process.execArgv.join(" "),n=A.indexOf("--inspect")!==-1,d=A.indexOf("--debug-brk")!==-1,h=[];return n&&(h.push("--inspect="+f.debugPort),d&&h.push("--debug-brk")),process.execArgv.forEach(function(k){k.indexOf("--max-old-space-size")>-1&&h.push(k)}),Object.assign({},f,{forkArgs:f.forkArgs,forkOpts:Object.assign({},f.forkOpts,{execArgv:(f.forkOpts&&f.forkOpts.execArgv||[]).concat(h),stdio:f.emitStdStreams?"pipe":void 0})})}function R(f){for(var A=new Error(""),n=Object.keys(f),d=0;d<n.length;d++)A[n[d]]=f[n[d]];return A}function U(f,A){if(Object.keys(f.processing).length===1){var n=Object.values(f.processing)[0];n.options&&typeof n.options.on=="function"&&n.options.on(A)}}function q(f,A){var n=this,d=A||{};this.script=f||r(),this.worker=u(this.script,d),this.debugPort=d.debugPort,this.forkOpts=d.forkOpts,this.forkArgs=d.forkArgs,this.workerOpts=d.workerOpts,this.workerThreadOpts=d.workerThreadOpts,this.workerTerminateTimeout=d.workerTerminateTimeout,f||(this.worker.ready=!0),this.requestQueue=[],this.worker.on("stdout",function(m){U(n,{stdout:m.toString()})}),this.worker.on("stderr",function(m){U(n,{stderr:m.toString()})}),this.worker.on("message",function(m){if(!n.terminated)if(typeof m=="string"&&m==="ready")n.worker.ready=!0,k();else{var M=m.id,x=n.processing[M];if(x!==void 0&&(m.isEvent?x.options&&typeof x.options.on=="function"&&x.options.on(m.payload):(delete n.processing[M],n.terminating===!0&&n.terminate(),m.error?x.resolver.reject(R(m.error)):x.resolver.resolve(m.result))),m.method===W){var D=n.tracking[m.id];D!==void 0&&(m.error?(clearTimeout(D.timeoutId),D.resolver.reject(R(m.error))):(n.tracking&&clearTimeout(D.timeoutId),D.resolver.resolve(D.result))),delete n.tracking[M]}}});function h(m){n.terminated=!0;for(var M in n.processing)n.processing[M]!==void 0&&n.processing[M].resolver.reject(m);n.processing=Object.create(null)}function k(){var m=ie(n.requestQueue.splice(0)),M;try{for(m.s();!(M=m.n()).done;){var x=M.value;n.worker.send(x.message,x.transfer)}}catch(D){m.e(D)}finally{m.f()}}var O=this.worker;this.worker.on("error",h),this.worker.on("exit",function(m,M){var x=`Workerpool Worker terminated Unexpectedly
`;x+="    exitCode: `"+m+"`\n",x+="    signalCode: `"+M+"`\n",x+="    workerpool.script: `"+n.script+"`\n",x+="    spawnArgs: `"+O.spawnargs+"`\n",x+="    spawnfile: `"+O.spawnfile+"`\n",x+="    stdout: `"+O.stdout+"`\n",x+="    stderr: `"+O.stderr+"`\n",h(new Error(x))}),this.processing=Object.create(null),this.tracking=Object.create(null),this.terminating=!1,this.terminated=!1,this.cleaning=!1,this.terminationHandler=null,this.lastId=0}return q.prototype.methods=function(){return this.exec("methods")},q.prototype.exec=function(f,A,n,d){n||(n=s.defer());var h=++this.lastId;this.processing[h]={id:h,resolver:n,options:d};var k={message:{id:h,method:f,params:A},transfer:d&&d.transfer};this.terminated?n.reject(new Error("Worker is terminated")):this.worker.ready?this.worker.send(k.message,k.transfer):this.requestQueue.push(k);var O=this;return n.promise.catch(function(m){if(m instanceof s.CancellationError||m instanceof s.TimeoutError)return O.tracking[h]={id:h,resolver:s.defer()},delete O.processing[h],O.tracking[h].resolver.promise=O.tracking[h].resolver.promise.catch(function(M){delete O.tracking[h];var x=O.terminateAndNotify(!0).then(function(){throw M},function(D){throw D});return x}),O.worker.send({id:h,method:W}),O.tracking[h].timeoutId=setTimeout(function(){O.tracking[h].resolver.reject(m)},O.workerTerminateTimeout),O.tracking[h].resolver.promise;throw m})},q.prototype.busy=function(){return this.cleaning||Object.keys(this.processing).length>0},q.prototype.terminate=function(f,A){var n=this;if(f){for(var d in this.processing)this.processing[d]!==void 0&&this.processing[d].resolver.reject(new Error("Worker terminated"));this.processing=Object.create(null)}for(var h=0,k=Object.values(n.tracking);h<k.length;h++){var O=k[h];clearTimeout(O.timeoutId),O.resolver.reject(new Error("Worker Terminating"))}if(n.tracking=Object.create(null),typeof A=="function"&&(this.terminationHandler=A),this.busy())this.terminating=!0;else{var m=function(D){if(n.terminated=!0,n.cleaning=!1,n.worker!=null&&n.worker.removeAllListeners&&n.worker.removeAllListeners("message"),n.worker=null,n.terminating=!1,n.terminationHandler)n.terminationHandler(D,n);else if(D)throw D};if(this.worker)if(typeof this.worker.kill=="function"){if(this.worker.killed){m(new Error("worker already killed!"));return}var M=setTimeout(function(){n.worker&&n.worker.kill()},this.workerTerminateTimeout);this.worker.once("exit",function(){clearTimeout(M),n.worker&&(n.worker.killed=!0),m()}),this.worker.ready?this.worker.send(w):this.requestQueue.push({message:w}),this.cleaning=!0;return}else if(typeof this.worker.terminate=="function")this.worker.terminate(),this.worker.killed=!0;else throw new Error("Failed to terminate worker");m()}},q.prototype.terminateAndNotify=function(f,A){var n=s.defer();return A&&n.promise.timeout(A),this.terminate(f,function(d,h){d?n.reject(d):n.resolve(h)}),n.promise},g.exports=q,g.exports._tryRequireWorkerThreads=o,g.exports._setupProcessWorker=L,g.exports._setupBrowserWorker=l,g.exports._setupWorkerThreadWorker=v,g.exports.ensureWorkerThreads=P,g.exports}var ce,me;function Pe(){if(me)return ce;me=1;var t=65535;ce=s;function s(){this.ports=Object.create(null),this.length=0}return s.prototype.nextAvailableStartingAt=function(i){for(;this.ports[i]===!0;)i++;if(i>=t)throw new Error("WorkerPool debug port limit reached: "+i+">= "+t);return this.ports[i]=!0,this.length++,i},s.prototype.releasePort=function(i){delete this.ports[i],this.length--},ce}var fe,ve;function Se(){if(ve)return fe;ve=1;var t=G(),s=t.Promise,i=je(),p=I,c=Pe(),y=new c;function e(a,o){typeof a=="string"?this.script=a||null:(this.script=null,o=a),this.workers=[],this.tasks=[],o=o||{},this.forkArgs=Object.freeze(o.forkArgs||[]),this.forkOpts=Object.freeze(o.forkOpts||{}),this.workerOpts=Object.freeze(o.workerOpts||{}),this.workerThreadOpts=Object.freeze(o.workerThreadOpts||{}),this.debugPortStart=o.debugPortStart||43210,this.nodeWorker=o.nodeWorker,this.workerType=o.workerType||o.nodeWorker||"auto",this.maxQueueSize=o.maxQueueSize||1/0,this.workerTerminateTimeout=o.workerTerminateTimeout||1e3,this.onCreateWorker=o.onCreateWorker||function(){return null},this.onTerminateWorker=o.onTerminateWorker||function(){return null},this.emitStdStreams=o.emitStdStreams||!1,o&&"maxWorkers"in o?(E(o.maxWorkers),this.maxWorkers=o.maxWorkers):this.maxWorkers=Math.max((p.cpus||4)-1,1),o&&"minWorkers"in o&&(o.minWorkers==="max"?this.minWorkers=this.maxWorkers:(w(o.minWorkers),this.minWorkers=o.minWorkers,this.maxWorkers=Math.max(this.minWorkers,this.maxWorkers)),this._ensureMinWorkers()),this._boundNext=this._next.bind(this),this.workerType==="thread"&&i.ensureWorkerThreads()}e.prototype.exec=function(a,o,r){if(o&&!Array.isArray(o))throw new TypeError('Array expected as argument "params"');if(typeof a=="string"){var u=s.defer();if(this.tasks.length>=this.maxQueueSize)throw new Error("Max queue size of "+this.maxQueueSize+" reached");var l=this.tasks,v={method:a,params:o,resolver:u,timeout:null,options:r};l.push(v);var L=u.promise.timeout;return u.promise.timeout=function(R){return l.indexOf(v)!==-1?(v.timeout=R,u.promise):L.call(u.promise,R)},this._next(),u.promise}else{if(typeof a=="function")return this.exec("run",[String(a),o],r);throw new TypeError('Function or string expected as argument "method"')}},e.prototype.proxy=function(){if(arguments.length>0)throw new Error("No arguments expected");var a=this;return this.exec("methods").then(function(o){var r={};return o.forEach(function(u){r[u]=function(){return a.exec(u,Array.prototype.slice.call(arguments))}}),r})},e.prototype._next=function(){if(this.tasks.length>0){var a=this._getWorker();if(a){var o=this,r=this.tasks.shift();if(r.resolver.promise.pending){var u=a.exec(r.method,r.params,r.resolver,r.options).then(o._boundNext).catch(function(){if(a.terminated)return o._removeWorker(a)}).then(function(){o._next()});typeof r.timeout=="number"&&u.timeout(r.timeout)}else o._next()}}},e.prototype._getWorker=function(){for(var a=this.workers,o=0;o<a.length;o++){var r=a[o];if(r.busy()===!1)return r}return a.length<this.maxWorkers?(r=this._createWorkerHandler(),a.push(r),r):null},e.prototype._removeWorker=function(a){var o=this;return y.releasePort(a.debugPort),this._removeWorkerFromList(a),this._ensureMinWorkers(),new s(function(r,u){a.terminate(!1,function(l){o.onTerminateWorker({forkArgs:a.forkArgs,forkOpts:a.forkOpts,workerThreadOpts:a.workerThreadOpts,script:a.script}),l?u(l):r(a)})})},e.prototype._removeWorkerFromList=function(a){var o=this.workers.indexOf(a);o!==-1&&this.workers.splice(o,1)},e.prototype.terminate=function(a,o){var r=this;this.tasks.forEach(function(C){C.resolver.reject(new Error("Pool terminated"))}),this.tasks.length=0;var u=function(R){y.releasePort(R.debugPort),this._removeWorkerFromList(R)},l=u.bind(this),v=[],L=this.workers.slice();return L.forEach(function(C){var R=C.terminateAndNotify(a,o).then(l).always(function(){r.onTerminateWorker({forkArgs:C.forkArgs,forkOpts:C.forkOpts,workerThreadOpts:C.workerThreadOpts,script:C.script})});v.push(R)}),s.all(v)},e.prototype.stats=function(){var a=this.workers.length,o=this.workers.filter(function(r){return r.busy()}).length;return{totalWorkers:a,busyWorkers:o,idleWorkers:a-o,pendingTasks:this.tasks.length,activeTasks:o}},e.prototype._ensureMinWorkers=function(){if(this.minWorkers)for(var a=this.workers.length;a<this.minWorkers;a++)this.workers.push(this._createWorkerHandler())},e.prototype._createWorkerHandler=function(){var a=this.onCreateWorker({forkArgs:this.forkArgs,forkOpts:this.forkOpts,workerOpts:this.workerOpts,workerThreadOpts:this.workerThreadOpts,script:this.script})||{};return new i(a.script||this.script,{forkArgs:a.forkArgs||this.forkArgs,forkOpts:a.forkOpts||this.forkOpts,workerOpts:a.workerOpts||this.workerOpts,workerThreadOpts:a.workerThreadOpts||this.workerThreadOpts,debugPort:y.nextAvailableStartingAt(this.debugPortStart),workerType:this.workerType,workerTerminateTimeout:this.workerTerminateTimeout,emitStdStreams:this.emitStdStreams})};function E(a){if(!W(a)||!P(a)||a<1)throw new TypeError("Option maxWorkers must be an integer number >= 1")}function w(a){if(!W(a)||!P(a)||a<0)throw new TypeError("Option minWorkers must be an integer number >= 0")}function W(a){return typeof a=="number"}function P(a){return Math.round(a)==a}return fe=e,fe}var le={},de,we;function ke(){if(we)return de;we=1;function t(s,i){this.message=s,this.transfer=i}return de=t,de}var ge;function ye(){return ge||(ge=1,function(t){var s=ke(),i=G().Promise,p="__workerpool-terminate__",c="__workerpool-cleanup__",y=1e3,e={exit:function(){}},E={addAbortListener:function(u){e.abortListeners.push(u)},emit:e.emit};if(typeof self<"u"&&typeof postMessage=="function"&&typeof addEventListener=="function")e.on=function(r,u){addEventListener(r,function(l){u(l.data)})},e.send=function(r,u){u?postMessage(r,u):postMessage(r)};else if(typeof process<"u"){var w;try{w=X}catch(r){if(!(Z(r)==="object"&&r!==null&&r.code==="MODULE_NOT_FOUND"))throw r}if(w&&w.parentPort!==null){var W=w.parentPort;e.send=W.postMessage.bind(W),e.on=W.on.bind(W),e.exit=process.exit.bind(process)}else e.on=process.on.bind(process),e.send=function(r){process.send(r)},e.on("disconnect",function(){process.exit(1)}),e.exit=process.exit.bind(process)}else throw new Error("Script must be executed as a worker");function P(r){return Object.getOwnPropertyNames(r).reduce(function(u,l){return Object.defineProperty(u,l,{value:r[l],enumerable:!0})},{})}function a(r){return r&&typeof r.then=="function"&&typeof r.catch=="function"}e.methods={},e.methods.run=function(u,l){var v=new Function("return ("+u+").apply(this, arguments);");return v.worker=E,v.apply(v,l)},e.methods.methods=function(){return Object.keys(e.methods)},e.terminationHandler=void 0,e.abortListenerTimeout=y,e.abortListeners=[],e.terminateAndExit=function(r){var u=function(){e.exit(r)};if(!e.terminationHandler)return u();var l=e.terminationHandler(r);return a(l)?(l.then(u,u),l):(u(),new i(function(v,L){L(new Error("Worker terminating"))}))},e.cleanup=function(r){if(!e.abortListeners.length)return e.send({id:r,method:c,error:P(new Error("Worker terminating"))}),new i(function(U){U()});var u=function(){e.exit()},l=function(){e.abortListeners.length||(e.abortListeners=[])},v=e.abortListeners.map(function(U){return U()}),L,C=new i(function(U,q){L=setTimeout(function(){q(new Error("Timeout occured waiting for abort handler, killing worker"))},e.abortListenerTimeout)}),R=i.all(v).then(function(){clearTimeout(L),l()},function(){clearTimeout(L),u()});return i.all([R,C]).then(function(){e.send({id:r,method:c,error:null})},function(U){e.send({id:r,method:c,error:U?P(U):null})})};var o=null;e.on("message",function(r){if(r===p)return e.terminateAndExit(0);if(r.method===c)return e.cleanup(r.id);try{var u=e.methods[r.method];if(u){o=r.id;var l=u.apply(u,r.params);a(l)?l.then(function(v){v instanceof s?e.send({id:r.id,result:v.message,error:null},v.transfer):e.send({id:r.id,result:v,error:null}),o=null}).catch(function(v){e.send({id:r.id,result:null,error:P(v)}),o=null}):(l instanceof s?e.send({id:r.id,result:l.message,error:null},l.transfer):e.send({id:r.id,result:l,error:null}),o=null)}else throw new Error('Unknown method "'+r.method+'"')}catch(v){e.send({id:r.id,result:null,error:P(v)})}}),e.register=function(r,u){if(r)for(var l in r)r.hasOwnProperty(l)&&(e.methods[l]=r[l],e.methods[l].worker=E);u&&(e.terminationHandler=u.onTerminate,e.abortListenerTimeout=u.abortListenerTimeout||y),e.send("ready")},e.emit=function(r){if(o){if(r instanceof s){e.send({id:o,isEvent:!0,payload:r.message},r.transfer);return}e.send({id:o,isEvent:!0,payload:r})}},t.add=e.register,t.emit=e.emit}(le)),le}var Le=I.platform,Me=I.isMainThread,Ce=I.cpus;function De(t,s){var i=Se();return new i(t,s)}var Ie=T.pool=De;function Ne(t,s){var i=ye();i.add(t,s)}var Re=T.worker=Ne;function Ue(t){var s=ye();s.emit(t)}var He=T.workerEmit=Ue,Be=G(),Fe=Be.Promise,Qe=T.Promise=Fe,qe=T.Transfer=ke(),Ge=T.platform=Le,Ze=T.isMainThread=Me,$e=T.cpus=Ce;_.Promise=Qe,_.Transfer=qe,_.cpus=$e,_.default=T,_.isMainThread=Ze,_.platform=Ge,_.pool=Ie,_.worker=Re,_.workerEmit=He,Object.defineProperty(_,"__esModule",{value:!0})})}(V,V.exports)),V.exports}var ur=ar();const cr=""+new URL("../workers/heic-D04gNPWc.js",import.meta.url).href;var fr=he('<meta name="description" content="Converter for heif">'),lr=he('<p><a download="converted.heic">Download HEIC</a></p>'),dr=he('<div class="text-column"><h1>About this app</h1> <input type="file" accept="image/*"> <button>샘플 HEIC 디코딩 보기</button> <br> <canvas style="border: 1px solid #ccc; margin-top: 1rem;"></canvas> <!></div>');function Or(B,Q){ze(Q,!1);const _=ur.pool(cr,{workerOpts:{type:"module"}});xe(()=>{_.terminate(!0).catch(g=>{console.error("failure",g)})});let T=null,j=Oe(null),I=Oe();xe(()=>{H(j)&&URL.revokeObjectURL(H(j))});function J(g){for(var b=atob(g),N=new Uint8Array(b.length),S=0;S<b.length;S++)N[S]=b.charCodeAt(S);return N}function Y(){return J("AAAAHGZ0eXBoZWljAAAAAG1pZjFoZWljbWlhZgAAApRtZXRhAAAAAAAAACFoZGxyAAAAAAAAAABwaWN0AAAAAAAAAAAAAAAAAAAAAA5waXRtAAAAAAABAAAANGlsb2MAAAAAREAAAgABAAAAAAK4AAEAAAAAAAAAMgACAAAAAALqAAEAAAAAAAAAIwAAADhpaW5mAAAAAAACAAAAFWluZmUCAAAAAAEAAGh2YzEAAAAAFWluZmUCAAAAAAIAAGh2YzEAAAAB02lwcnAAAAGsaXBjbwAAAHZodmNDAQNwAAAAAAAAAAAAHvAA/P34+AAADwMgAAEAGEABDAH//wNwAAADAJAAAAMAAAMAHroCQCEAAQAqQgEBA3AAAAMAkAAAAwAAAwAeoCCBBZbqrprm4CGgwIAAAAMAgAAAAwCEIgABAAZEAcFzwYkAAAAUaXNwZQAAAAAAAABAAAAAQAAAAChjbGFwAAAACgAAAAEAAAAKAAAAAf///8oAAAAC////ygAAAAIAAAAQcGl4aQAAAAADCAgIAAAAcWh2Y0MBBAgAAAAAAAAAAAAe8AD8/Pj4AAAPAyAAAQAXQAEMAf//BAgAAAMAn/gAAAMAAB66AkAhAAEAJkIBAQQIAAADAJ/4AAADAAAewIIEFluqumubAgAAAwACAAADAAIQIgABAAZEAcFzwYkAAAAUaXNwZQAAAAAAAABAAAAAQAAAAChjbGFwAAAACgAAAAEAAAAKAAAAAf///8oAAAAC////ygAAAAIAAAAOcGl4aQAAAAABCAAAACdhdXhDAAAAAHVybjptcGVnOmhldmM6MjAxNTphdXhpZDoxAAAAAB9pcG1hAAAAAAAAAAIAAQSBAoMEAAIFhQaHCIkAAAAaaXJlZgAAAAAAAAAOYXV4bAACAAEAAQAAAF1tZGF0AAAALigBrxMhYmNA9Sci//75Mn/pHyf9QdlhZ3K6wVvy+sD2ZJvA86qRnoCHaacwFXgAAAAfKAGuJkJKJOfXDbP+G8cXYVVzU7JsIGJEKRKAY/X0rg==")}async function G(g,b,N){return await _.exec("jsEncodeImage",[g,b,N])}async function ee(g){return await _.exec("jsDecodeImage",[g])}async function ie(g){var K;if(T=((K=g.target.files)==null?void 0:K[0])??null,!T)return;const b=await createImageBitmap(T),S=new OffscreenCanvas(b.width,b.height).getContext("2d");S.drawImage(b,0,0);const F=S.getImageData(0,0,b.width,b.height),$=await G(F.data,F.width,F.height);console.log("received result",$);const ue=new Blob([$.data],{type:"image/heic"});H(j)&&URL.revokeObjectURL(H(j)),pe(j,URL.createObjectURL(ue))}async function se(){const g=Y();console.log("window input decodeSampleImage",g);const b=await ee(g);console.log("decodeSampleImage",b);const N=H(I).getContext("2d");_e(I,H(I).width=10),_e(I,H(I).height=10);const S=new ImageData(new Uint8ClampedArray(b.data[0].data),10,10);N.putImageData(S,0,0);const F=await G(S.data,S.width,S.height),$=new Blob([F.data],{type:"image/heic"});H(j)&&URL.revokeObjectURL(H(j)),pe(j,URL.createObjectURL($))}tr();var z=dr();Ve(g=>{var b=fr();Je.title="About",Ae(g,b)});var re=oe(be(z),2),te=oe(re,2),ne=oe(te,4);rr(ne,g=>pe(I,g),()=>H(I));var Z=oe(ne,2);{var ae=g=>{var b=lr(),N=be(b);Ee(b),Ke(()=>er(N,"href",H(j))),Ae(g,b)};Ye(Z,g=>{H(j)&&g(ae)})}Ee(z),Te("change",re,ie),Te("click",te,se),Ae(B,z),Xe()}export{Or as component};
