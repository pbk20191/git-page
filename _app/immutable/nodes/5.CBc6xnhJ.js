import{t as Ct,a as kt}from"../chunks/CtYR2VL8.js";import{p as Nt,aa as k,Y as _t,G as bt,s as n,c as l,t as Bt,K as t,a as Ft,W as v,r as s}from"../chunks/BiaDghIV.js";import{s as Et}from"../chunks/B-R2J0SN.js";import{s as at}from"../chunks/CL-5-TAf.js";import{s as xt,r as y}from"../chunks/Cgoudy-_.js";import{d as Ot,e as At}from"../chunks/gFQPrapg.js";import{a as M,J as Dt}from"../chunks/Dazn8mIu.js";import{b as nt,F as Jt}from"../chunks/tOPgWaih.js";import{b as wt}from"../chunks/BlZKb0-f.js";import{o as Xt}from"../chunks/BGpdg9QL.js";import{t as yt,w as Yt}from"../chunks/4eif3qM-.js";const Gt=""+new URL("../workers/XcodeNinePatchRenderer-s_5YJu5X.js",import.meta.url).href;var Lt=(u,f)=>f(u,"left"),Ut=(u,f)=>f(u,"right"),jt=(u,f)=>f(u,"top"),Kt=(u,f)=>f(u,"bottom"),Tt=Ct(`<main class="container" style="max-width: 980px; margin: 24px auto; padding: 16px;"><h1 style="font: 600 20px/1.2 system-ui, -apple-system, sans-serif; margin-bottom: 16px;">iOS Nine-Patch Resizer (OffscreenCanvas + Comlink)</h1> <section style="display: grid; grid-template-columns: 1fr; gap: 12px; margin-bottom: 12px;"><label>PNG File <input name="xcode_png_ninepatch_input" type="file" accept="image/png"></label> <div style="display:flex; gap:12px; flex-wrap:wrap;"><label>Source Scale <select name="source_scale"><option>1x</option><option>2x</option><option>3x</option></select></label> <label>Resizing Mode <select name="resizing_mode"><option>9-part</option><option>3-part-horizontal</option><option>3-part-vertical</option></select></label> <label>Center Mode <select name="center_mode"><option>stretch</option><option>tile</option></select></label> <button>Export ResizingInfo</button></div></section> <section><canvas width="1" height="1" style=" height: auto; image-rendering: crisp-edges; border: 1px solid #ddd; border-radius: 8px;"></canvas> <div style="margin-top:8px; font: 12px/1.3 ui-monospace, SFMono-Regular, Menlo, monospace;"> </div> <fieldset style="
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px 16px;
    border: 1px solid #ccc;
    border-radius: 8px;
    padding: 8px 12px;
  "><label style="display: flex; flex-direction: column;">Left <input name="left_inset" type="number" min="0" step="1"></label> <label style="display: flex; flex-direction: column;">Right <input name="right_inset" type="number" min="0" step="1"></label> <label style="display: flex; flex-direction: column;">Top <input name="top_inset" type="number" min="0" step="1"></label> <label style="display: flex; flex-direction: column;">Bottom <input name="bottom_inset" type="number" min="0" step="1"></label></fieldset></section> <section><h6>Preview</h6> <fieldset style=" display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px 16px;
    border: 1px solid #ccc;
    border-radius: 8px;
    padding: 8px 12px;"><label>Preview Width <input type="number" name="preview_width"></label> <label>Preview Height <input type="number" name="preview_height"></label></fieldset> <canvas></canvas></section></main>`);function le(u,f){Nt(f,!0);let b,g=k(3),c=k("9-part"),z=k("stretch"),N=null,a=k(_t({left:0,right:0,top:0,bottom:0})),d=!1,W=null,i=null,S,m=_t({w:10,h:10});Xt(()=>{W==null||W.terminate(),W=null,i=null});async function Mt(){if(i)return i;const e=new Worker(Gt,{type:"module"});W=e,i=Yt(e);const o=b.transferControlToOffscreen();return await i.attach(yt(o,[o])),i}async function Wt(e){var dt;const p=(dt=e.target.files)==null?void 0:dt[0];if(!p)return;if(p.type!=="image/png"){alert("Please select a PNG file");return}N=p.name.replace(/@[\dx]+(?=\.png$)|\.png$/g,""),p.name.endsWith("@3x.png")?v(g,3):p.name.endsWith("@2x.png")?v(g,2):p.name.endsWith("@1x.png")&&v(g,1);const r=await createImageBitmap(p,{colorSpaceConversion:"none",premultiplyAlpha:"premultiply"}),_=await Mt();await _.setSource(yt(r,[r]),t(g));const h=await _.getState();v(a,{left:Math.round(h.canvasW*.2),right:Math.round(h.canvasW*.2),top:Math.round(h.canvasH*.2),bottom:Math.round(h.canvasH*.2)},!0),m.h=h.canvasH,m.w=h.canvasW,await _.setInsets(at(t(a)),"right","bottom"),await x()}async function x(){var o;if(!i)return;let e=await i.createBitmap(S.width,S.height);(o=S.getContext("bitmaprenderer"))==null||o.transferFromImageBitmap(e)}async function St(){if(!i)return;await i.setScale(t(g));const e=await i.getState();t(a).left=Math.min(t(a).left,e.canvasW-1),t(a).right=Math.min(t(a).right,e.canvasW-1),t(a).top=Math.min(t(a).top,e.canvasH-1),t(a).bottom=Math.min(t(a).bottom,e.canvasH-1),await i.setInsets(at(t(a)),"right","bottom"),await x()}function it(e){const o=b.getBoundingClientRect(),p=Math.max(0,Math.min(e.clientX-o.left,o.width)),r=Math.max(0,Math.min(e.clientY-o.top,o.height)),_=b.width/o.width,h=b.height/o.height;return{x:Math.round(p*_),y:Math.round(r*h)}}async function zt(e){if(!i)return;const{x:o,y:p}=it(e),r=await i.queryNearestEdge(o,p);t(c)=="3-part-horizontal"&&(r==="top"||r==="bottom")||t(c)=="3-part-vertical"&&(r==="left"||r==="right")||(d=r,await ot(e))}async function ot(e){if(!d||!i)return;const{x:o,y:p}=it(e),r=await i.getState();d==="left"?t(a).left=Math.max(0,Math.min(o,r.canvasW-1)):d==="right"?t(a).right=Math.max(0,Math.min(r.canvasW-o,r.canvasW-1)):d==="top"?t(a).top=Math.max(0,Math.min(p,r.canvasH-1)):d==="bottom"&&(t(a).bottom=Math.max(0,Math.min(r.canvasH-p,r.canvasH-1))),t(a).left+t(a).right>=r.canvasW&&(t(a).right=Math.max(0,r.canvasW-t(a).left-1)),t(a).top+t(a).bottom>=r.canvasH&&(t(a).bottom=Math.max(0,r.canvasH-t(a).top-1)),await i.setInsets(at(t(a))),await x()}function rt(){d=!1}async function $t(){if(!i||!N)return;const e=N,o=await i.exportAsset(e),p=new Dt,r=p.folder(`${e}.imageset`);r.file(`${e}@3x.png`,o.image3x),r.file(`${e}@2x.png`,o.image2x),r.file(`${e}@1x.png`,o.image1x),r.file("Contents.json",JSON.stringify(o.contents));const _=await p.generateAsync({type:"blob"});Jt.saveAs(_,"Demo.zip")}function It(){return t(c)==="3-part-horizontal"?`
        left:${t(a).left}, right:${t(a).right}
        `:t(c)==="3-part-vertical"?`
        top:${t(a).top}, bottom:${t(a).bottom}
        `:`
    left:${t(a).left}, right:${t(a).right}
    top:${t(a).top}, bottom:${t(a).bottom}
    `}bt(()=>{t(c),t(z),i&&i.setMode(t(c),t(z)).then(async()=>{await x()})});async function $(e,o){i&&(o==="left"?await i.setInsets({left:t(a).left},"right","bottom"):o==="right"?await i.setInsets({right:t(a).right},"left","bottom"):o==="bottom"?await i.setInsets({bottom:t(a).bottom},"right","top"):o==="top"&&await i.setInsets({top:t(a).top},"right","bottom"),v(a,(await i.getState()).insets,!0),await x())}bt(()=>{m.w,m.h,i&&i.getState().then(async()=>{await x()})});var B=Tt(),F=n(l(B),2),E=l(F),Pt=n(l(E));Pt.__change=Wt,s(E);var lt=n(E,2),O=l(lt),I=n(l(O));I.__change=St;var A=l(I);A.value=(A.__value=1)==null?"":1;var D=n(A);D.value=(D.__value=2)==null?"":2;var st=n(D);st.value=(st.__value=3)==null?"":3,s(I),s(O);var J=n(O,2),X=n(l(J)),Y=l(X);Y.value=(Y.__value="9-part")==null?"":"9-part";var G=n(Y);G.value=(G.__value="3-part-horizontal")==null?"":"3-part-horizontal";var pt=n(G);pt.value=(pt.__value="3-part-vertical")==null?"":"3-part-vertical",s(X),s(J);var L=n(J,2),U=n(l(L)),j=l(U);j.value=(j.__value="stretch")==null?"":"stretch";var ct=n(j);ct.value=(ct.__value="tile")==null?"":"tile",s(U),s(L);var Rt=n(L,2);Rt.__click=$t,s(lt),s(F);var K=n(F,2),w=l(K);w.__mousedown=zt,w.__mousemove=ot,w.__mouseup=rt,wt(w,e=>b=e,()=>b);var T=n(w,2),Ht=l(T);s(T);var mt=n(T,2),q=l(mt),P=n(l(q));y(P),P.__change=[Lt,$],s(q);var Z=n(q,2),R=n(l(Z));y(R),R.__change=[Ut,$],s(Z);var Q=n(Z,2),H=n(l(Q));y(H),H.__change=[jt,$],s(Q);var ut=n(Q,2),C=n(l(ut));y(C),C.__change=[Kt,$],s(ut),s(mt),s(K);var ft=n(K,2),V=n(l(ft),2),tt=l(V),ht=n(l(tt));y(ht),s(tt);var vt=n(tt,2),gt=n(l(vt));y(gt),s(vt),s(V);var et=n(V,2);wt(et,e=>S=e,()=>S),s(ft),s(B),Bt(e=>{Et(Ht,`insets: ${e??""}`),P.disabled=t(c)=="3-part-vertical",R.disabled=t(c)=="3-part-vertical",H.disabled=t(c)=="3-part-horizontal",C.disabled=t(c)=="3-part-horizontal",xt(et,"width",m.w),xt(et,"height",m.h)},[It]),nt(I,()=>t(g),e=>v(g,e)),nt(X,()=>t(c),e=>v(c,e)),nt(U,()=>t(z),e=>v(z,e)),At("mouseleave",w,rt),M(P,()=>t(a).left,e=>t(a).left=e),M(R,()=>t(a).right,e=>t(a).right=e),M(H,()=>t(a).top,e=>t(a).top=e),M(C,()=>t(a).bottom,e=>t(a).bottom=e),M(ht,()=>m.w,e=>m.w=e),M(gt,()=>m.h,e=>m.h=e),kt(u,B),Ft()}Ot(["change","click","mousedown","mousemove","mouseup"]);export{le as component};
