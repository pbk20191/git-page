import{t as _t,a as bt}from"../chunks/CtYR2VL8.js";import{p as xt,aa as $,Y as yt,G as wt,s as l,c as s,t as Mt,K as t,a as Wt,W as f,r as p}from"../chunks/BiaDghIV.js";import{s as It}from"../chunks/B-R2J0SN.js";import{s as K}from"../chunks/CL-5-TAf.js";import{r as z}from"../chunks/Cgoudy-_.js";import{d as St,e as $t}from"../chunks/gFQPrapg.js";import{a as R,J as zt}from"../chunks/Dazn8mIu.js";import{b as q,F as Rt}from"../chunks/tOPgWaih.js";import{b as Ct}from"../chunks/BlZKb0-f.js";import{o as Ht}from"../chunks/BGpdg9QL.js";import{t as st,w as kt}from"../chunks/4eif3qM-.js";const Nt=""+new URL("../workers/XcodeNinePatchRenderer-DmVnPkNd.js",import.meta.url).href;var Pt=(m,u)=>u(m,"left"),Bt=(m,u)=>u(m,"right"),Dt=(m,u)=>u(m,"top"),Et=(m,u)=>u(m,"bottom"),Ft=_t(`<main class="container" style="max-width: 980px; margin: 24px auto; padding: 16px;"><h1 style="font: 600 20px/1.2 system-ui, -apple-system, sans-serif; margin-bottom: 16px;">iOS Nine-Patch Resizer (OffscreenCanvas + Comlink)</h1> <section style="display: grid; grid-template-columns: 1fr; gap: 12px; margin-bottom: 12px;"><label>PNG File <input name="xcode_png_ninepatch_input" type="file" accept="image/png"></label> <div style="display:flex; gap:12px; flex-wrap:wrap;"><label>Source Scale <select name="source_scale"><option>1x</option><option>2x</option><option>3x</option></select></label> <label>Resizing Mode <select name="resizing_mode"><option>9-part</option><option>3-part-horizontal</option><option>3-part-vertical</option></select></label> <label>Center Mode <select name="center_mode"><option>stretch</option><option>tile</option></select></label> <button>Export ResizingInfo</button></div></section> <section><canvas width="1" height="1" style="width: 100%; height: auto; image-rendering: crisp-edges; border: 1px solid #ddd; border-radius: 8px;"></canvas> <div style="margin-top:8px; font: 12px/1.3 ui-monospace, SFMono-Regular, Menlo, monospace;"> </div> <fieldset style="
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px 16px;
    border: 1px solid #ccc;
    border-radius: 8px;
    padding: 8px 12px;
  "><label style="display: flex; flex-direction: column;">Left <input name="left_inset" type="number" min="0" step="1"></label> <label style="display: flex; flex-direction: column;">Right <input name="right_inset" type="number" min="0" step="1"></label> <label style="display: flex; flex-direction: column;">Top <input name="top_inset" type="number" min="0" step="1"></label> <label style="display: flex; flex-direction: column;">Bottom <input name="bottom_inset" type="number" min="0" step="1"></label></fieldset></section></main>`);function qt(m,u){xt(u,!0);let d,h=$(3),c=$("9-part"),C=$("stretch"),H=null,e=$(yt({left:0,right:0,top:0,bottom:0})),g=!1,x=null,i=null;Ht(()=>{x==null||x.terminate(),x=null,i=null});async function pt(){if(i)return i;const a=new Worker(Nt,{type:"module"});x=a,i=kt(a);const n=d.transferControlToOffscreen();return await i.attach(st(n,[n])),i}async function ct(a){var rt;const r=(rt=a.target.files)==null?void 0:rt[0];if(!r)return;if(r.type!=="image/png"){alert("Please select a PNG file");return}H=r.name.replace(/@[\dx]+(?=\.png$)|\.png$/g,""),r.name.endsWith("@3x.png")?f(h,3):r.name.endsWith("@2x.png")?f(h,2):r.name.endsWith("@1x.png")&&f(h,1);const o=await createImageBitmap(r,{colorSpaceConversion:"none",premultiplyAlpha:"premultiply"}),v=await pt();await v.setSource(st(o,[o]),t(h));const b=await v.getState();f(e,{left:Math.round(b.canvasW*.2),right:Math.round(b.canvasW*.2),top:Math.round(b.canvasH*.2),bottom:Math.round(b.canvasH*.2)},!0),await v.setInsets(K(t(e)),"right","bottom")}async function mt(){if(!i)return;await i.setScale(t(h));const a=await i.getState();t(e).left=Math.min(t(e).left,a.canvasW-1),t(e).right=Math.min(t(e).right,a.canvasW-1),t(e).top=Math.min(t(e).top,a.canvasH-1),t(e).bottom=Math.min(t(e).bottom,a.canvasH-1),await i.setInsets(K(t(e)),"right","bottom")}function V(a){const n=d.getBoundingClientRect(),r=Math.max(0,Math.min(a.clientX-n.left,n.width)),o=Math.max(0,Math.min(a.clientY-n.top,n.height)),v=d.width/n.width,b=d.height/n.height;return{x:Math.round(r*v),y:Math.round(o*b)}}async function ut(a){if(!i)return;const{x:n,y:r}=V(a),o=await i.queryNearestEdge(n,r);t(c)=="3-part-horizontal"&&(o==="top"||o==="bottom")||t(c)=="3-part-vertical"&&(o==="left"||o==="right")||(g=o,await Z(a))}async function Z(a){if(!g||!i)return;const{x:n,y:r}=V(a),o=await i.getState();g==="left"?t(e).left=Math.max(0,Math.min(n,o.canvasW-1)):g==="right"?t(e).right=Math.max(0,Math.min(o.canvasW-n,o.canvasW-1)):g==="top"?t(e).top=Math.max(0,Math.min(r,o.canvasH-1)):g==="bottom"&&(t(e).bottom=Math.max(0,Math.min(o.canvasH-r,o.canvasH-1))),t(e).left+t(e).right>=o.canvasW&&(t(e).right=Math.max(0,o.canvasW-t(e).left-1)),t(e).top+t(e).bottom>=o.canvasH&&(t(e).bottom=Math.max(0,o.canvasH-t(e).top-1)),await i.setInsets(K(t(e)))}function Q(){g=!1}async function ft(){if(!i||!H)return;const a=H,n=await i.exportAsset(a),r=new zt,o=r.folder(`${a}.imageset`);o.file(`${a}@3x.png`,n.image3x),o.file(`${a}@2x.png`,n.image2x),o.file(`${a}@1x.png`,n.image1x),o.file("Contents.json",JSON.stringify(n.contents));const v=await r.generateAsync({type:"blob"});Rt.saveAs(v,"Demo.zip")}function ht(){return t(c)==="3-part-horizontal"?`
        left:${t(e).left}, right:${t(e).right}
        `:t(c)==="3-part-vertical"?`
        top:${t(e).top}, bottom:${t(e).bottom}
        `:`
    left:${t(e).left}, right:${t(e).right}
    top:${t(e).top}, bottom:${t(e).bottom}
    `}wt(()=>{i&&i.setMode(t(c),t(C))});async function y(a,n){console.log("onChangeInsetByInput",t(e).left,a.currentTarget.value,n),i&&(n==="left"?await i.setInsets({left:t(e).left},"right","bottom"):n==="right"?await i.setInsets({right:t(e).right},"left","bottom"):n==="bottom"?await i.setInsets({bottom:t(e).bottom},"right","top"):n==="top"&&await i.setInsets({top:t(e).top},"right","bottom"),f(e,(await i.getState()).insets,!0))}var k=Ft(),N=l(s(k),2),P=s(N),gt=l(s(P));gt.__change=ct,p(P);var tt=l(P,2),B=s(tt),w=l(s(B));w.__change=mt;var D=s(w);D.value=(D.__value=1)==null?"":1;var E=l(D);E.value=(E.__value=2)==null?"":2;var et=l(E);et.value=(et.__value=3)==null?"":3,p(w),p(B);var F=l(B,2),O=l(s(F)),A=s(O);A.value=(A.__value="9-part")==null?"":"9-part";var G=l(A);G.value=(G.__value="3-part-horizontal")==null?"":"3-part-horizontal";var at=l(G);at.value=(at.__value="3-part-vertical")==null?"":"3-part-vertical",p(O),p(F);var J=l(F,2),L=l(s(J)),T=s(L);T.value=(T.__value="stretch")==null?"":"stretch";var nt=l(T);nt.value=(nt.__value="tile")==null?"":"tile",p(L),p(J);var vt=l(J,2);vt.__click=ft,p(tt),p(N);var ot=l(N,2),_=s(ot);_.__mousedown=ut,_.__mousemove=Z,_.__mouseup=Q,Ct(_,a=>d=a,()=>d);var U=l(_,2),dt=s(U);p(U);var it=l(U,2),X=s(it),M=l(s(X));z(M),M.__change=[Pt,y],p(X);var Y=l(X,2),W=l(s(Y));z(W),W.__change=[Bt,y],p(Y);var j=l(Y,2),I=l(s(j));z(I),I.__change=[Dt,y],p(j);var lt=l(j,2),S=l(s(lt));z(S),S.__change=[Et,y],p(lt),p(it),p(ot),p(k),Mt(a=>{It(dt,`insets: ${a??""}`),M.disabled=t(c)=="3-part-vertical",W.disabled=t(c)=="3-part-vertical",I.disabled=t(c)=="3-part-horizontal",S.disabled=t(c)=="3-part-horizontal"},[ht]),q(w,()=>t(h),a=>f(h,a)),q(O,()=>t(c),a=>f(c,a)),q(L,()=>t(C),a=>f(C,a)),$t("mouseleave",_,Q),R(M,()=>t(e).left,a=>t(e).left=a),R(W,()=>t(e).right,a=>t(e).right=a),R(I,()=>t(e).top,a=>t(e).top=a),R(S,()=>t(e).bottom,a=>t(e).bottom=a),bt(m,k),Wt()}St(["change","click","mousedown","mousemove","mouseup"]);export{qt as component};
