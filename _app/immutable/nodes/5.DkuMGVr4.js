import{t as bt,a as xt}from"../chunks/CtYR2VL8.js";import{p as yt,aa as I,Y as st,G as wt,s as l,c as s,t as Mt,K as t,a as Wt,W as f,r as p}from"../chunks/BiaDghIV.js";import{s as St}from"../chunks/B-R2J0SN.js";import{s as T}from"../chunks/CL-5-TAf.js";import{r as R}from"../chunks/Cgoudy-_.js";import{d as $t,e as zt}from"../chunks/gFQPrapg.js";import{a as C,J as It}from"../chunks/Dazn8mIu.js";import{b as q,F as Rt}from"../chunks/tOPgWaih.js";import{b as Ct}from"../chunks/BlZKb0-f.js";import{o as Ht}from"../chunks/BGpdg9QL.js";import{t as pt,w as Nt}from"../chunks/4eif3qM-.js";const kt=""+new URL("../workers/XcodeNinePatchRenderer-CF7tdN3-.js",import.meta.url).href;var Pt=(m,u)=>u(m,"left"),Ft=(m,u)=>u(m,"right"),Et=(m,u)=>u(m,"top"),Ot=(m,u)=>u(m,"bottom"),At=bt(`<main class="container" style="max-width: 980px; margin: 24px auto; padding: 16px;"><h1 style="font: 600 20px/1.2 system-ui, -apple-system, sans-serif; margin-bottom: 16px;">iOS Nine-Patch Resizer (OffscreenCanvas + Comlink)</h1> <section style="display: grid; grid-template-columns: 1fr; gap: 12px; margin-bottom: 12px;"><label>PNG File <input name="xcode_png_ninepatch_input" type="file" accept="image/png"></label> <div style="display:flex; gap:12px; flex-wrap:wrap;"><label>Source Scale <select name="source_scale"><option>1x</option><option>2x</option><option>3x</option></select></label> <label>Resizing Mode <select name="resizing_mode"><option>9-part</option><option>3-part-horizontal</option><option>3-part-vertical</option></select></label> <label>Center Mode <select name="center_mode"><option>stretch</option><option>tile</option></select></label> <button>Export ResizingInfo</button></div></section> <section><canvas width="1" height="1" style=" height: auto; image-rendering: crisp-edges; border: 1px solid #ddd; border-radius: 8px;"></canvas> <div style="margin-top:8px; font: 12px/1.3 ui-monospace, SFMono-Regular, Menlo, monospace;"> </div> <fieldset style="
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px 16px;
    border: 1px solid #ccc;
    border-radius: 8px;
    padding: 8px 12px;
  "><label style="display: flex; flex-direction: column;">Left <input name="left_inset" type="number" min="0" step="1"></label> <label style="display: flex; flex-direction: column;">Right <input name="right_inset" type="number" min="0" step="1"></label> <label style="display: flex; flex-direction: column;">Top <input name="top_inset" type="number" min="0" step="1"></label> <label style="display: flex; flex-direction: column;">Bottom <input name="bottom_inset" type="number" min="0" step="1"></label></fieldset></section></main>`);function qt(m,u){yt(u,!0);let d,h=I(3),c=I("9-part"),y=I("stretch"),H=null,e=I(st({left:0,right:0,top:0,bottom:0})),g=!1,x=null,o=null;st({w:10,h:10}),Ht(()=>{x==null||x.terminate(),x=null,o=null});async function ct(){if(o)return o;const a=new Worker(kt,{type:"module"});x=a,o=Nt(a);const i=d.transferControlToOffscreen();return await o.attach(pt(i,[i])),o}async function mt(a){var rt;const r=(rt=a.target.files)==null?void 0:rt[0];if(!r)return;if(r.type!=="image/png"){alert("Please select a PNG file");return}H=r.name.replace(/@[\dx]+(?=\.png$)|\.png$/g,""),r.name.endsWith("@3x.png")?f(h,3):r.name.endsWith("@2x.png")?f(h,2):r.name.endsWith("@1x.png")&&f(h,1);const n=await createImageBitmap(r,{colorSpaceConversion:"none",premultiplyAlpha:"premultiply"}),v=await ct();await v.setSource(pt(n,[n]),t(h));const b=await v.getState();f(e,{left:Math.round(b.canvasW*.2),right:Math.round(b.canvasW*.2),top:Math.round(b.canvasH*.2),bottom:Math.round(b.canvasH*.2)},!0),await v.setInsets(T(t(e)),"right","bottom")}async function ut(){if(!o)return;await o.setScale(t(h));const a=await o.getState();t(e).left=Math.min(t(e).left,a.canvasW-1),t(e).right=Math.min(t(e).right,a.canvasW-1),t(e).top=Math.min(t(e).top,a.canvasH-1),t(e).bottom=Math.min(t(e).bottom,a.canvasH-1),await o.setInsets(T(t(e)),"right","bottom")}function Z(a){const i=d.getBoundingClientRect(),r=Math.max(0,Math.min(a.clientX-i.left,i.width)),n=Math.max(0,Math.min(a.clientY-i.top,i.height)),v=d.width/i.width,b=d.height/i.height;return{x:Math.round(r*v),y:Math.round(n*b)}}async function ft(a){if(!o)return;const{x:i,y:r}=Z(a),n=await o.queryNearestEdge(i,r);t(c)=="3-part-horizontal"&&(n==="top"||n==="bottom")||t(c)=="3-part-vertical"&&(n==="left"||n==="right")||(g=n,await Q(a))}async function Q(a){if(!g||!o)return;const{x:i,y:r}=Z(a),n=await o.getState();g==="left"?t(e).left=Math.max(0,Math.min(i,n.canvasW-1)):g==="right"?t(e).right=Math.max(0,Math.min(n.canvasW-i,n.canvasW-1)):g==="top"?t(e).top=Math.max(0,Math.min(r,n.canvasH-1)):g==="bottom"&&(t(e).bottom=Math.max(0,Math.min(n.canvasH-r,n.canvasH-1))),t(e).left+t(e).right>=n.canvasW&&(t(e).right=Math.max(0,n.canvasW-t(e).left-1)),t(e).top+t(e).bottom>=n.canvasH&&(t(e).bottom=Math.max(0,n.canvasH-t(e).top-1)),await o.setInsets(T(t(e)))}function V(){g=!1}async function ht(){if(!o||!H)return;const a=H,i=await o.exportAsset(a),r=new It,n=r.folder(`${a}.imageset`);n.file(`${a}@3x.png`,i.image3x),n.file(`${a}@2x.png`,i.image2x),n.file(`${a}@1x.png`,i.image1x),n.file("Contents.json",JSON.stringify(i.contents));const v=await r.generateAsync({type:"blob"});Rt.saveAs(v,"Demo.zip")}function gt(){return t(c)==="3-part-horizontal"?`
        left:${t(e).left}, right:${t(e).right}
        `:t(c)==="3-part-vertical"?`
        top:${t(e).top}, bottom:${t(e).bottom}
        `:`
    left:${t(e).left}, right:${t(e).right}
    top:${t(e).top}, bottom:${t(e).bottom}
    `}wt(()=>{t(c),t(y),o&&o.setMode(t(c),t(y)).then(async()=>{})});async function w(a,i){o&&(i==="left"?await o.setInsets({left:t(e).left},"right","bottom"):i==="right"?await o.setInsets({right:t(e).right},"left","bottom"):i==="bottom"?await o.setInsets({bottom:t(e).bottom},"right","top"):i==="top"&&await o.setInsets({top:t(e).top},"right","bottom"),f(e,(await o.getState()).insets,!0))}var N=At(),k=l(s(N),2),P=s(k),vt=l(s(P));vt.__change=mt,p(P);var tt=l(P,2),F=s(tt),M=l(s(F));M.__change=ut;var E=s(M);E.value=(E.__value=1)==null?"":1;var O=l(E);O.value=(O.__value=2)==null?"":2;var et=l(O);et.value=(et.__value=3)==null?"":3,p(M),p(F);var A=l(F,2),B=l(s(A)),D=s(B);D.value=(D.__value="9-part")==null?"":"9-part";var G=l(D);G.value=(G.__value="3-part-horizontal")==null?"":"3-part-horizontal";var at=l(G);at.value=(at.__value="3-part-vertical")==null?"":"3-part-vertical",p(B),p(A);var J=l(A,2),L=l(s(J)),U=s(L);U.value=(U.__value="stretch")==null?"":"stretch";var nt=l(U);nt.value=(nt.__value="tile")==null?"":"tile",p(L),p(J);var dt=l(J,2);dt.__click=ht,p(tt),p(k);var ot=l(k,2),_=s(ot);_.__mousedown=ft,_.__mousemove=Q,_.__mouseup=V,Ct(_,a=>d=a,()=>d);var X=l(_,2),_t=s(X);p(X);var it=l(X,2),Y=s(it),W=l(s(Y));R(W),W.__change=[Pt,w],p(Y);var j=l(Y,2),S=l(s(j));R(S),S.__change=[Ft,w],p(j);var K=l(j,2),$=l(s(K));R($),$.__change=[Et,w],p(K);var lt=l(K,2),z=l(s(lt));R(z),z.__change=[Ot,w],p(lt),p(it),p(ot),p(N),Mt(a=>{St(_t,`insets: ${a??""}`),W.disabled=t(c)=="3-part-vertical",S.disabled=t(c)=="3-part-vertical",$.disabled=t(c)=="3-part-horizontal",z.disabled=t(c)=="3-part-horizontal"},[gt]),q(M,()=>t(h),a=>f(h,a)),q(B,()=>t(c),a=>f(c,a)),q(L,()=>t(y),a=>f(y,a)),zt("mouseleave",_,V),C(W,()=>t(e).left,a=>t(e).left=a),C(S,()=>t(e).right,a=>t(e).right=a),C($,()=>t(e).top,a=>t(e).top=a),C(z,()=>t(e).bottom,a=>t(e).bottom=a),xt(m,N),Wt()}$t(["change","click","mousedown","mousemove","mouseup"]);export{qt as component};
